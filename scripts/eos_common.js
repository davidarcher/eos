function sliderButtonLooper(e){if(sBIntervalHolder.length<20){var t=setInterval(e,150);sBIntervalHolder.push(t)}}function jqDialogInit(e,t,n){if(typeof e==="undefined"||e=="")return false;if(typeof t==="undefined")t={};jQuery.ajax({type:"POST",url:e,data:t,dataType:"html",success:function(e){jQuery("#jq-dialog-modal").html(e).dialog({modal:true,width:rjJQModalWidth,zIndex:9900,resizable:false,open:function(){jQuery("#jq-dialog-modal input:first").blur()},beforeClose:function(){modalController.backLink="";modalController.backLinkTitle="";if(typeof modalController.modalCdt!=="undefined"&&modalController.modalCdt)clearInterval(modalController.modalCdt)}});if(typeof n==="function"){n()}if(jQuery("#jq-dialog-modal").dialog().height()>jQuery(window).height()){jQuery(".ui-dialog").css("top","0");jQuery(".ui-dialog").get(0).scrollIntoView()}else if(parseInt(jQuery(".ui-dialog").css("top"))<jQuery(window).scrollTop()){jQuery(".ui-dialog").get(0).scrollIntoView()}},error:function(e,t,n){console.log(e.responseText)}})}function formatNum(e,t,n){if(typeof n==="undefined"){n=0}if(n){var r=Math.pow(10,t);e=Math.floor(e*r)/r}if(typeof t!=="undefined"){e=parseFloat(e);e=e.toFixed(t)}e+="";var i=e.split(".");var s=i[0];var o=i.length>1?"."+i[1]:"";var u=/(\d+)(\d{3})/;while(u.test(s)){s=s.replace(u,"$1"+","+"$2")}return s+o}function formatNumReadable(e){var t=Math.abs(e);var n=0;var r=[""," k"," M"," B"," T"," Q"," E"," Z"];while(t>=1e3){e=e/1e3;t=t/1e3;n=n+1}if(t>=100)return formatNum(e,0,1)+r[n];if(t>=10)return formatNum(e,1,1)+r[n];return formatNum(e,2,1)+r[n]}function sec2hms(e){var t,n,r,i;if(e<0){t="00:00:00";return t}n=Math.floor(e/3600);e=e%3600;r=Math.floor(e/60);i=Math.floor(e%60);if(n<10)n="0"+n;if(r<10)r="0"+r;if(i<10)i="0"+i;t=n+":"+r+":"+i;return t}function hms2sec(e){var t=e.split(":");var n,r=0;if(n=t.length){for(var i=0;i<n;i++){t[i]=parseFloat(t[i]);if(isNaN(t[i])){t[i]=0}}switch(n){case 1:r=t[0];break;case 2:r=t[0]*60+t[1];break;case 3:r=t[0]*60*60+t[1]*60+t[2];break;case 4:r=t[0]*24*60*60+t[1]*60*60+t[2]*60+t[3];break;default:r=0}}return r}function min2hm(e){var t,n,r;if(e<0){t="00:00";return t}n=Math.floor(e/60);r=Math.floor(e%60);if(n<10)n="0"+n;if(r<10)r="0"+r;t=n+":"+r;return t}function hm2min(e){var t=e.split(":");var n,r=0;if(n=t.length){for(var i=0;i<n;i++){t[i]=parseFloat(t[i]);if(isNaN(t[i])){t[i]=0}}switch(n){case 1:r=t[0];break;case 2:r=t[0]*60+t[1];break;case 3:r=t[0]*24*60+t[1]*60+t[2];break;default:r=0}}return r}function stripCommas(e){var t=/[,\s\$]/g;if(typeof e==="number")e=e.toString();return e.replace(t,"")}function isUrl(e){var t=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return t.test(e)}function percentComp(e,t){var n;if(e<0){return"100.0"}n=100*(1-e/t);n=n.toFixed(1);return n}function getLabelLumin(e){e=e.replace("#","");var t=parseInt(e.substr(0,2),16);var n=parseInt(e.substr(2,2),16);var r=parseInt(e.substr(4,2),16);var i=(t*299+n*587+r*114)/1e3;return i>=128?"#000000":"#ffffff"}function colorPieChartLabels(e){var t=Math.min(jQuery("#plot_market_share .jqplot-data-label").length-1,e.length);for(var n=0;n<t;n++){jQuery("#plot_market_share .jqplot-data-label").eq(n).css("color",getLabelLumin(e[n]))}}function getCookie(e){var t,n,r,i=document.cookie.split(";");for(t=0;t<i.length;t++){n=i[t].substr(0,i[t].indexOf("="));r=i[t].substr(i[t].indexOf("=")+1);n=n.replace(/^\s+|\s+$/g,"");if(n==e){return unescape(r)}}}function setCookie(e,t,n){if(typeof n==="undefined")n=365;var r=new Date;r.setDate(r.getDate()+n);document.cookie=e+"="+escape(t)+"; expires="+r.toUTCString()}function toggleDisplayNone(e){var t=document.getElementById(e);if(t){if(t.style.display=="none"){t.style.display="";jQuery("#"+e+"_ctrl").html("(-)")}else{t.style.display="none";jQuery("#"+e+"_ctrl").html("(+)")}}}function executeFunctionByName(e,t,n){var n=Array.prototype.slice.call(arguments).splice(2);var r=e.split(".");var i=r.pop();for(var s=0;s<r.length;s++){t=t[r[s]]}return t[i].apply(this,n)}function DDInit(e,t){if(typeof e==="undefined"||!e){var e="form_image_up"}if(typeof t["subId"]==="undefined"||!t["subId"]){var n=document.getElementById(e+"_ddarea");var r=document.getElementById(e+"_btn");var i=document.getElementById(e+"_sortable");var s=e+"_progress"}else{var n=document.getElementById(e+"_ddarea_"+t["subId"]);var r=document.getElementById(e+"_btn_"+t["subId"]);var i=document.getElementById(e+"_sortable_"+t["subId"]);var s=e+"_progress_"+t["subId"]}if(typeof t["sortableUrl"]!=="undefined"&&t["sortableUrl"]){jQuery(i).sortable({helper:"clone",update:function(e,n){var r=jQuery(this).sortable("toArray").toString();var i={image_id_list:r};if(typeof t["sortableParams"]!=="undefined"){jQuery.extend(i,t["sortableParams"])}jQuery.post(t["sortableUrl"],i)}});jQuery(i).disableSelection()}if(typeof n!=="undefined"){var o=new XMLHttpRequest;if(o.upload){n.addEventListener("dragover",FileDragHover,false);n.addEventListener("dragleave",FileDragHover,false);n.addEventListener("drop",function(n){FileSelectHandler(n,e,t)},false)}r.addEventListener("change",function(n){FileSelectHandler(n,e,t)},false);if(document.getElementById(s)){jQuery("#"+s).progressbar()}}}function FileDragHover(e){e.stopPropagation();e.preventDefault();e.target.className=e.type=="dragover"?"drag_drop_area hover":"drag_drop_area"}function FileSelectHandler(e,t,n){FileDragHover(e);if(e.dataTransfer){var r=e.dataTransfer.getData("text")||e.dataTransfer.getData("text/plain");var i=e.dataTransfer.files}else{var r="";var i=e.target.files}var s=50;if(r.length>0){var o=r.match(/^.*([\n\r]+|$)/gm);s=Math.min(s,o.length);if(typeof n["reqTitle"]!=="undefined"&&n["reqTitle"]&&s>2){jConfirm("You are about to upload "+s+" files that request text entry.<br />			Press OK to continue, or Cancel to upload the files without text entry.","Confirm Text Entry",function(e){if(!e){n["reqTitle"]=0}for(var r=0;r<s;r++){UploadUrl(o[r].replace(/[ \t\n\r]+?/g,""),t,n)}})}else{for(var u=0;u<s;u++){UploadUrl(o[u].replace(/[ \t\n\r]+?/g,""),t,n)}}}if(i.length>0){s=Math.min(s,i.length);window.totalUploadSize=new Array;window.finishedUploadSize=new Array;window.totalUploadSize[t]=0;window.finishedUploadSize[t]=0;for(u=0;u<i.length;u++){window.totalUploadSize[t]+=i[u].size}if(typeof n["reqTitle"]!=="undefined"&&n["reqTitle"]&&s>2){jConfirm("You are about to upload "+s+" files that request text entry.<br />			Press OK to continue, or Cancel to upload the files without text entry.","Confirm Text Entry",function(e){if(!e){n["reqTitle"]=0}for(var r=0;r<s;r++){UploadFile(i[r],t,n)}})}else{for(var u=0;u<s;u++){UploadFile(i[u],t,n)}}}}function UpdateUploadProgress(e,t,n){if(typeof n["subId"]==="undefined"||!n["subId"]){var r=t+"_progress"}else{var r=t+"_progress_"+n["subId"]}if(document.getElementById(r)){if(e.lengthComputable){var i=(e.loaded+window.finishedUploadSize[t])/window.totalUploadSize[t]*100;jQuery("#"+r).progressbar("option","value",i)}}}function UploadUrl(e,t,n){if(e.replace(/^\s+|\t|\s+$/g,"").length>0){if(isUrl(e)){if(typeof n["subId"]==="undefined"||!n["subId"]){var r="#"+t+"_sortable"}else{var r="#"+t+"_sortable_"+n["subId"]}if(typeof n["reqTitle"]!=="undefined"&&n["reqTitle"]){if(n["reqTitle"]==1){var i=prompt("Please input a title for the uploaded file.",e);n["uploadParams"]["title"]=i}else{var i=prompt(n["reqTitle"],file.name);n["uploadParams"]["title"]=i}if(i==null||i==""){return false}}var s=new XMLHttpRequest;s.onreadystatechange=function(e){if(s.readyState==4&&s.status==200){var t=true;try{var i=JSON.parse(s.responseText)}catch(o){t=false}if(t){if(i["success"]){if(i["callback"]){executeFunctionByName(i["callback"],window,i)}else if(i["jsonAction"]){setTimeout(i["jsonAction"],300)}else{if(typeof n["callbackPrepend"]!=="undefined"&&n["callbackPrepend"]){jQuery(r).prepend(s.responseText)}else{jQuery(r).append(s.responseText)}}}else{if(i["jsonMsg"]){jAlert(i["jsonMsg"])}}}else{if(typeof n["callbackPrepend"]!=="undefined"&&n["callbackPrepend"]){jQuery(r).prepend(s.responseText)}else{jQuery(r).append(s.responseText)}}}};var o=new FormData;o.append("fileurl",e);if(typeof n["uploadParams"]!=="undefined"){for(var u in n["uploadParams"]){if(n["uploadParams"].hasOwnProperty(u)){o.append(u,n["uploadParams"][u])}}}s.open("POST",n["uploadUrl"],true);s.send(o)}}}function UploadFile(e,t,n){var r=new XMLHttpRequest;if(typeof n["subId"]==="undefined"||!n["subId"]){var i="#"+t+"_sortable"}else{var i="#"+t+"_sortable_"+n["subId"]}if(typeof n["reqTitle"]!=="undefined"&&n["reqTitle"]){if(n["reqTitle"]==1){var s=prompt("Please input a title for the uploaded file.",e.name);n["uploadParams"]["title"]=s}else{var s=prompt(n["reqTitle"],e.name);n["uploadParams"]["title"]=s}if(s==null||s==""){return false}}if(r.upload){if(e.size>5e6){jAlert("File size is too large!");return false}r.onreadystatechange=function(e){if(r.readyState==4&&r.status==200){var t=true;try{var s=JSON.parse(r.responseText)}catch(o){t=false}if(t){if(s["success"]){if(s["callback"]){executeFunctionByName(s["callback"],window,s)}else if(s["jsonAction"]){setTimeout(s["jsonAction"],300)}else{if(typeof n["callbackPrepend"]!=="undefined"&&n["callbackPrepend"]){jQuery(i).prepend(r.responseText)}else{jQuery(i).append(r.responseText)}}}else{if(s["jsonMsg"]){jAlert(s["jsonMsg"])}}}else{if(typeof n["callbackPrepend"]!=="undefined"&&n["callbackPrepend"]){jQuery(i).prepend(r.responseText)}else{jQuery(i).append(r.responseText)}}}};var o=new FormData;o.append("file",e);if(typeof n["uploadParams"]!=="undefined"){for(var u in n["uploadParams"]){if(n["uploadParams"].hasOwnProperty(u)){o.append(u,n["uploadParams"][u])}}}r.open("POST",n["uploadUrl"],true);r.addEventListener("progress",function(r){var i=r.loaded||r.position,s=r.total||r.totalSize;if(i/s*100==100){window.finishedUploadSize[t]+=e.size;UpdateUploadProgress(r,t,n)}},false);if(r.upload){r.upload.onprogress=function(e){UpdateUploadProgress(e,t,n)}}r.send(o)}}var rjJQModalWidth=840;var labelDblClick=0;var sBIntervalHolder=new Array;var sBLooperInterval;jQuery(document).on("mousedown",".slider_button_add_one",function(){if(sBLooperInterval)clearInterval(sBLooperInterval);sBLooperInterval=setInterval("sliderButtonLooper('"+$(this).attr("onclick")+"')",300)});jQuery(document).on("mouseup mouseout",".slider_button_add_one",function(){clearInterval(sBLooperInterval);while(sBIntervalHolder.length){var e=sBIntervalHolder.pop();clearInterval(e)}});jQuery(document).on("mousedown",".slider_button_subtract_one",function(){if(sBLooperInterval)clearInterval(sBLooperInterval);sBLooperInterval=setInterval("sliderButtonLooper('"+$(this).attr("onclick")+"')",300)});jQuery(document).on("mouseup mouseout",".slider_button_subtract_one",function(){clearInterval(sBLooperInterval);while(sBIntervalHolder.length){var e=sBIntervalHolder.pop();clearInterval(e)}});jQuery(document).ready(function(){jQuery(document).on("click",".jqDialog",function(e){e.preventDefault();var t=jQuery(e.currentTarget).attr("params");if(typeof t==="undefined"){jqDialogInit(jQuery(e.currentTarget).attr("href"))}else{var n,r={};var i=t.split("&");for(var s=0;s<i.length;s++){n=i[s].split("=");r[n[0]]=n[1]}jqDialogInit(jQuery(e.currentTarget).attr("href"),r)}});jQuery(document).on("click",".jqDialog-close-btn",function(e){jQuery("#jq-dialog-modal").dialog("close")});jQuery(document).on("click",".ui-widget-overlay",function(){if(jQuery("#jq-dialog-modal").hasClass("ui-dialog-content"))jQuery("#jq-dialog-modal").dialog("close")});jQuery(document).on("click","input:checkbox+label",function(e){if(!$(this).prev("input").prop("disabled")){$(this).prev("input").prop("checked",function(e,t){return!t})}e.preventDefault()})});var bldgController={tip_slot:0,max_buildings:0,cd_on:[],cd_total:[],cd_remaining:[],bldg_type:[],bldg_id:[],bldg_title:[],bldg_status:[],executeAjax:function(e,t){jQuery.ajax({type:"POST",url:"bldg_controller.php",data:e,dataType:"json",success:function(e){if(e.success){if(typeof t==="function"){t(e)}}else{if(typeof e.msg!=="undefined"&&e.msg){jAlert(e.msg)}else{jAlert("Something went wrong")}}},error:function(e,t,n){console.log(e.responseText)}})},go:function(e){if(e==window.location.href)return false;jqDialogInit(e)},countDown:function(){var e=0;var t=2;var n=38;var r=0;for(i=1;i<=this.max_buildings;i++){if(this.cd_on[i]){this.cd_remaining[i]-=1;e=percentComp(this.cd_remaining[i],this.cd_total[i]);t=2+.36*e;t=t.toFixed(0);n=40-t;r=sec2hms(this.cd_remaining[i])+" ("+e+"% Complete)";if(i==this.tip_slot){jQuery("#tipbox").html(this.bldg_title[i]+"<br />Status: "+this.bldg_status[i]+"<br />Time Remaining: "+r)}document.getElementById("cd_icon_"+i).style.top=n+"px";document.getElementById("cd_icon_"+i).style.height=t+"px";document.getElementById("cd_icon_"+i).style.backgroundPosition="0px -"+n+"px";if(this.cd_remaining[i]<=0){this.updateSlot(i);this.cd_on[i]=0;if(this.bldg_type[i]=="fact"||this.bldg_type[i]=="rnd"){progressController.refreshQueue(this.bldg_type[i])}}}}},setTip:function(e){this.tip_slot=e;if(typeof this.bldg_status[this.tip_slot]!=="undefined"&&this.bldg_status[this.tip_slot]){jQuery("#tipbox").html(this.bldg_title[this.tip_slot]+"<br />Status: "+this.bldg_status[this.tip_slot]);document.getElementById("tipbox").style.visibility="visible"}else{if(typeof this.bldg_title[this.tip_slot]!=="undefined"&&this.bldg_title[this.tip_slot]){jQuery("#tipbox").html(this.bldg_title[this.tip_slot]);document.getElementById("tipbox").style.visibility="visible"}}},unsetTip:function(){this.tip_slot=0;document.getElementById("tipbox").style.visibility="hidden"},updateAllSlots:function(){var e={action:"update_all_slots",max_buildings:this.max_buildings};this.executeAjax(e,function(e){bldgController.cd_on=e.cd_on;bldgController.cd_total=e.cd_total;bldgController.cd_remaining=e.cd_remaining;bldgController.bldg_type=e.bldg_type;bldgController.bldg_id=e.bldg_id;bldgController.bldg_title=e.bldg_title;bldgController.bldg_status=e.bldg_status;var t=0;for(i in e.cd_icon_back){if(e.cd_icon_back.hasOwnProperty(i)){t++}}for(i=1;i<=t;i++){document.getElementById("cd_icon_back_"+i).className=e.cd_icon_back[i];document.getElementById("cd_icon_"+i).className=e.cd_icon[i];jQuery("#building_image_"+i).html(e.bldg_image[i]);jQuery("#cd_icon_title_"+i).attr("href",e.bldg_link[i])}})},updateSlot:function(e){var t={action:"update_slot",slot:e,max_buildings:this.max_buildings};this.executeAjax(t,function(t){bldgController.cd_on[e]=t.cd_on;bldgController.cd_total[e]=t.cd_total;bldgController.cd_remaining[e]=t.cd_remaining;bldgController.bldg_type[e]=t.bldg_type;bldgController.bldg_id[e]=t.bldg_id;bldgController.bldg_title[e]=t.bldg_title;bldgController.bldg_status[e]=t.bldg_status;document.getElementById("cd_icon_back_"+e).className=t.cd_icon_back;document.getElementById("cd_icon_"+e).className=t.cd_icon;jQuery("#building_image_"+e).html(t.bldg_image);jQuery("#cd_icon_title_"+e).attr("href",t.bldg_link)})},updateSlotReady:function(e){this.cd_on[e]=0;this.cd_total[e]=0;this.cd_remaining[e]=0;this.bldg_title[e]="Ready";document.getElementById("cd_icon_back_"+e).className="anim_placeholder";document.getElementById("cd_icon_"+e).className="anim_placeholder"},updateSlotEmptyLand:function(e){this.cd_on[e]=0;this.cd_total[e]=0;this.cd_remaining[e]=0;this.bldg_type[e]="";this.bldg_id[e]=0;this.bldg_title[e]="New Building";this.bldg_status[e]="";document.getElementById("cd_icon_back_"+e).className="anim_placeholder";document.getElementById("cd_icon_"+e).className="anim_placeholder";jQuery("#building_image_"+e).html('<img class="no_select" src="images/city/bldg_new.gif" width="90" height="40" />');jQuery("#cd_icon_title_"+e).attr("href","bldg-build.php?slot="+e)},updateSlotBuyLand:function(e){if(e>this.max_buildings)return false;this.cd_on[e]=0;this.cd_total[e]=0;this.cd_remaining[e]=0;this.bldg_type[e]="";this.bldg_id[e]=0;this.bldg_title[e]="Purchase Land";this.bldg_status[e]="";document.getElementById("cd_icon_back_"+e).className="anim_placeholder";document.getElementById("cd_icon_"+e).className="anim_placeholder";jQuery("#building_image_"+e).html('<img class="no_select" src="images/city/bldg_buy_land.gif" width="90" height="40" />');jQuery("#cd_icon_title_"+e).attr("href","bldg-buy-land.php")},showNameUpdater:function(e,t,n){jQuery("#building_name").html('<form style="float:left;margin-right:10px;" onsubmit="bldgController.updateName('+t+",'"+n+'\');return false;"><input class="bigger_input" type="text" id="building_name_new" name="building_name_new" value="'+e+'" /> <input class="bigger_input" type="submit" value="Submit" />')},updateName:function(e,t){var n=jQuery("#building_name_new").val();if(!n){return false}var r={action:"update_name",id:e,type:t,name:n};this.executeAjax(r,function(n){var r=n.name+" ("+n.size+' m&#178;) <img src="/eos/images/edit.gif" width="24" height="24" onclick="bldgController.showNameUpdater(\''+n.name+"',"+e+",'"+t+"');\" />";jQuery("#building_name").html(r);if(typeof (bldgController.bldg_title[n.slot]!=="undefined")){bldgController.bldg_title[n.slot]=n.name+" ("+n.size+" m&#178;)"}})},swapBldgs:function(){var e=jQuery("#swap_building_1").val();var t=jQuery("#swap_building_2").val();if(!e||!t){return false}var n={action:"swap_bldgs",bldg_1:e,bldg_2:t};this.executeAjax(n,function(e){bldgController.updateSlot(e.slot_1);bldgController.updateSlot(e.slot_2);jQuery("#swap_building_prompt").html('<img src="/eos/images/check.gif" /> Success!<br /><br /><a class="jqDialog" href="bldg-swap-slot.php"><input type="button" class="bigger_input" value="Swap other buildings"></a>')})}};var chatController={config_x:0,config_y:0,config_width:200,config_height:150,connId:0,pauseScroll:0,executeAjax:function(e,t){jQuery.ajax({type:"POST",url:"chat_controller.php",data:e,dataType:"json",success:function(e){if(e.success){if(typeof t==="function"){t(e)}}else{if(typeof e.disconnect!=="undefined"&&e.disconnect){$("#chatbox_new_msg").prop("disabled",true).val("");$("#chatbox_send").prop("disabled",true)}}if(typeof e.msg!=="undefined"&&e.msg){chatController.showMsg(0,0,"System",e.msg)}},error:function(e,t,n){chatController.showMsg(0,0,"System","Disconnected.")}})},init:function(){var e=150;var t=200;var n=68;jQuery("#chatbox_ctrl_ns").addClass("hidden");jQuery("#chatbox_ctrl_norm").addClass("hidden");jQuery("#eos_stats_panel .show_chat_control").on("click",function(){if(!jQuery("#chatbox").dialog("isOpen")){chatController.init()}});var r='<div id="chatbox_ma" style="height:'+(Math.max(e,chatController.config_height)-n-40)+'px;"></div><div class="chatbox_new_msg_area"><input id="chatbox_new_msg" type="text" class="bigger_input" maxlength="240" /><input id="chatbox_send" type="button" value="Send" /></div>';jQuery("#chatbox").html(r).dialog({modal:false,position:[chatController.config_x,chatController.config_y],minWidth:t,minHeight:e,width:Math.max(chatController.config_width,t),title:"Chat",zIndex:9901,resizable:true,create:function(e,t){$("#chatbox").prev("div.ui-dialog-titlebar").css({padding:"0 1em"});$(e.target).parent().css("position","fixed")},open:function(t,r){$("#chatbox").parent("div.ui-dialog").height(Math.max(chatController.config_height,e));$("#chatbox").height(Math.max(chatController.config_height,e));$("#chatbox_ma").height($("#chatbox").height()-n);$("#chatbox_ma").width($("#chatbox").width()-12);$("#chatbox_new_msg").width($("#chatbox").width()-68).prop("disabled",true);$("#chatbox_send").prop("disabled",true);chatController.connect()},close:function(e,t){$("#chatbox_new_msg").prop("disabled",true).val("");$("#chatbox_send").prop("disabled",true);chatController.disconnect();jQuery("#chatbox_ctrl_ns").removeClass("hidden");jQuery("#chatbox_ctrl_norm").removeClass("hidden")},resize:function(e,t){$("#chatbox").height($("#chatbox").parent("div.ui-dialog").height());$("#chatbox_ma").height($("#chatbox").height()-n);$("#chatbox_ma").width($("#chatbox").width()-12);$("#chatbox_new_msg").width($("#chatbox").width()-68)},resizeStop:function(e,t){var n=[Math.floor(t.position.left)-$(window).scrollLeft(),Math.floor(t.position.top)-$(window).scrollTop()];$(e.target).parent().css("position","fixed");$("#chatbox").dialog("option","position",n);chatController.updatePosition()},dragStop:function(e,t){chatController.updatePosition()}})},connect:function(){chatController.showMsg(0,0,"System","Connecting to chat...");var e={action:"connect"};this.executeAjax(e,function(e){chatController.showMsg(0,0,"System","Connected.");playerController.playerId=e.player_id;playerController.playerName=e.player_name;$("#chatbox_new_msg").prop("disabled",false);$("#chatbox_send").prop("disabled",false);$("#chatbox_ma").on("mouseenter",function(){chatController.pauseScroll=1});$("#chatbox_ma").on("mouseleave",function(){chatController.pauseScroll=0});chatController.connId=e.conn_id;$("#chatbox_new_msg").on("keypress",function(e){if(e.which==13){chatController.sendMsg(0)}});$("#chatbox_send").on("click",function(){chatController.sendMsg(0)});chatController.getMsgs(0,0)})},disconnect:function(){var e={action:"disconnect",conn_id:chatController.connId};this.executeAjax(e);chatController.connId=0;chatController.showMsg(0,0,"System","Disconnected.")},updatePosition:function(){var e=$("#chatbox").parent("div.ui-dialog").position();chatController.config_x=Math.floor(e.left-$(window).scrollLeft());chatController.config_y=Math.floor(e.top-$(window).scrollTop());chatController.config_height=$("#chatbox").height();chatController.config_width=$("#chatbox").width();var t={action:"update_position",left:chatController.config_x,top:chatController.config_y,height:chatController.config_height,width:chatController.config_width};this.executeAjax(t)},showMsg:function(e,t,n,r){if(t==0){jQuery("#chatbox_ma").append('<div style="color:#ff0000;">'+n+": "+r+"</div>")}else{jQuery("#chatbox_ma").append('<div id="chat_msg_'+e+'"><a href="/eos/player/'+t+'" target="_blank">'+n+"</a>: "+r+"</div>")}},getMsgs:function(e,t){if(typeof document.getElementById("chatbox_ma")==="undefined"||document.getElementById("chatbox_ma")===null){return false}var n={action:"get_msgs",conn_id:chatController.connId,chan_id:e,st:t};this.executeAjax(n,function(t){setTimeout("chatController.getMsgs("+e+", "+t.curr_time+");",1500);if(t.msgs.length){for(var n=0;n<t.msgs.length;n++){msg=t.msgs[n];if(typeof document.getElementById("chat_msg_"+msg["id"])==="undefined"||document.getElementById("chat_msg_"+msg["id"])===null){chatController.showMsg(msg["id"],msg["player_id"],msg["player_name"],msg["body"])}}if(!chatController.pauseScroll){jQuery("#chatbox_ma").animate({scrollTop:jQuery("#chatbox_ma")[0].scrollHeight-jQuery("#chatbox_ma").height()},500)}}})},sendMsg:function(e){var t=jQuery("#chatbox_new_msg").val();jQuery("#chatbox_new_msg").val("");if(t=="")return false;var n={action:"send_msg",conn_id:chatController.connId,chan_id:e,msg_body:t};chatController.executeAjax(n,function(e){chatController.showMsg(e.msg_id,playerController.playerId,playerController.playerName,t)})}};var esController={executeAjax:function(e,t){jQuery.ajax({type:"POST",url:"es_controller.php",data:e,dataType:"json",success:function(e){if(e.success){if(typeof t==="function"){t(e)}}else{if(typeof e.msg!=="undefined"&&e.msg){jAlert(e.msg)}else{jAlert("Something went wrong")}}},error:function(e,t,n){console.log(e.responseText)}})},submitApplication:function(e){var t=document.getElementById("esc_cover_letter").value;var n={action:"es_apply",esp_id:e,cover_letter:t};this.executeAjax(n,function(e){var t="<h3>Application Sent</h3> 			Good luck getting hired!";jQuery("#es_application_form").html(t);if(parseInt(jQuery(".ui-dialog").css("top"))<jQuery(window).scrollTop()){jQuery(".ui-dialog").get(0).scrollIntoView()}})},hireCandidate:function(e,t){var n={action:"es_hire",esp_id:e,esp_pid:t};this.executeAjax(n,function(e){var t="<h3>Candidate Hired</h3>";t+=e.msg;jQuery("#es_view_applicants_form").html(t);if(parseInt(jQuery(".ui-dialog").css("top"))<jQuery(window).scrollTop()){jQuery(".ui-dialog").get(0).scrollIntoView()}})},updateAssignment:function(e){salary=document.getElementById("salary").value;bonus=document.getElementById("bonus").value;if(e==0){var t=document.getElementById("esc_title").value;var n=document.getElementById("esc_duration").value;var r=document.getElementById("esc_daily_allowance_unlimited").checked?1:0;var i=Math.round(stripCommas(document.getElementById("esc_daily_allowance").value)*100);if(!r&&document.getElementById("esc_daily_allowance").value==""){jAlert("Please enter a daily spending limit, or enter 0 if no spending is allowed.");jQuery("#esc_daily_allowance").focus();return false}var s=document.getElementById("esc_bldg_hurry").checked?1:0;var o=document.getElementById("esc_bldg_land").checked?1:0;var u=1;var a=document.getElementById("esc_fact_produce").checked?1:0;var f=document.getElementById("esc_fact_cancel").checked?1:0;var l=document.getElementById("esc_fact_build").checked?1:0;var c=document.getElementById("esc_fact_expand").checked?1:0;var h=document.getElementById("esc_fact_sell").checked?1:0;var p=document.getElementById("esc_store_price").checked?1:0;var d=document.getElementById("esc_store_ad").checked?1:0;var v=document.getElementById("esc_store_build").checked?1:0;var m=document.getElementById("esc_store_expand").checked?1:0;var g=document.getElementById("esc_store_sell").checked?1:0;var y=document.getElementById("esc_rnd_res").checked?1:0;var b=document.getElementById("esc_rnd_cancel").checked?1:0;var w=document.getElementById("esc_rnd_hurry").checked?1:0;var E=document.getElementById("esc_rnd_build").checked?1:0;var S=document.getElementById("esc_rnd_expand").checked?1:0;var x=document.getElementById("esc_rnd_sell").checked?1:0;var T=document.getElementById("esc_wh_view").checked?1:0;var N=document.getElementById("esc_wh_sell").checked?1:0;var C=document.getElementById("esc_wh_discard").checked?1:0;var k=document.getElementById("esc_b2b_buy").checked?1:0;var L=document.getElementById("esc_hr_post").checked?1:0;var A=document.getElementById("esc_hr_hire").checked?1:0;var O=document.getElementById("esc_hr_fire").checked?1:0;var M={action:"new_assignment",salary:salary,bonus:bonus,esc_title:t,esc_duration:n,esc_daily_allowance:i,esc_daily_allowance_unlimited:r,esc_bldg_hurry:s,esc_bldg_land:o,esc_bldg_view:1,esc_fact_produce:a,esc_fact_cancel:f,esc_fact_build:l,esc_fact_expand:c,esc_fact_sell:h,esc_store_price:p,esc_store_ad:d,esc_store_build:v,esc_store_expand:m,esc_store_sell:g,esc_rnd_res:y,esc_rnd_cancel:b,esc_rnd_hurry:w,esc_rnd_build:E,esc_rnd_expand:S,esc_rnd_sell:x,esc_wh_view:T,esc_wh_sell:N,esc_wh_discard:C,esc_b2b_buy:k,esc_hr_post:L,esc_hr_hire:A,esc_hr_fire:O}}else{var M={action:"update_assignment",esp_id:e,salary:salary,bonus:bonus}}this.executeAjax(M,function(t){if(e==0){var n="<h3>Assignment Submitted</h3>"}else{var n="<h3>Assignment Updated</h3>"}n+="We will do our best to help you find your dream candidate!";jQuery("#es_assignment_form").html(n);if(parseInt(jQuery(".ui-dialog").css("top"))<jQuery(window).scrollTop()){jQuery(".ui-dialog").get(0).scrollIntoView()}})},cancelAssignment:function(e){jConfirm("Are you sure sure you want to cancel this search assignment? No refund will be given and all existing applications will be discarded.","Cancel Assignment",function(t){if(t){var n={action:"cancel_assignment",esp_id:e};esController.executeAjax(n,function(e){var t="<h3>Assignment Canceled</h3> 					The search has been terminated by your request.";jQuery("#es_assignment_form").html(t)})}})}};var firmController={firmId:0,cash:0,allowance:0,levelDesc:["Garage Shop","Fledgling Start-Up","Start-Up","Small Enterprise","Medium Enterprise","Large Enterprise","Nano Cap","Micro Cap","Small Cap","Mid Cap","Large Cap","Conglomerate","Large Conglomerate","MNC","Corporate Empire"],levelThreshold:[0,25e6,5e7,1e8,3e8,1e9,3e9,1e10,3e10,1e11,1e12,1e13,1e14,1e15,1e16],fameDesc:["Unknown","Unnoticed","Trivial","Obscure","Uncertain","Ordinary","Recognized","Distinguished","Locally Known","Well-Known","Prominent","Widely Acclaimed","Illustrious","Stellar","Symbolic","Monumental","Universal","Paramount","Legendary","Immortal"],executeAjax:function(e,t){jQuery.ajax({type:"POST",url:"firm_controller.php",data:e,dataType:"json",success:function(e){if(e.success){if(typeof t==="function"){t(e)}}else{if(typeof e.msg!=="undefined"&&e.msg){jAlert(e.msg)}else{jAlert("Something went wrong")}}},error:function(e,t,n){console.log(e.responseText)}})},setCash:function(e,t){if(t==-1){jQuery("#firm_cash").html('<a class="info">$'+formatNumReadable(e/100)+'<span style="width:240px !important;">Cash: $'+formatNum(e/100,2)+"<br />Allowance: Unlimited</span></a>")}else{jQuery("#firm_cash").html('<a class="info">$'+formatNumReadable(Math.min(e,t)/100)+'<span style="width:240px !important;">Cash: $'+formatNum(e/100,2)+"<br />Allowance: $"+formatNum(t/100,2)+"</span></a>")}},setLoan:function(e){jQuery("#firm_loan").html('<a class="info">$'+formatNumReadable(e/100)+'<span style="width:240px !important;">Loan: $'+formatNum(e/100,2)+"</span></a>")},setNetworth:function(e){jQuery("#firm_networth").html('<a class="info">$'+formatNumReadable(e/100)+'<span style="width:240px !important;">Networth: $'+formatNum(e/100,2)+"<br />Networth is updated daily around midnight server time.</span></a>")},setLevel:function(e){var t='<a class="info">'+this.levelDesc[e]+'<span style="width:240px !important;">Company Level: '+e+" ("+this.levelDesc[e]+")<br />";var n=parseInt(e)+1;if(n<this.levelDesc.length){t+="Next Level: "+n+" ("+this.levelDesc[n]+")<br />At $"+formatNum(this.levelThreshold[n],2)+" NW ($"+formatNumReadable(this.levelThreshold[n]/100)+")</span></a>"}else{t+="Congratulations! You've reached the highest level possible. This IS the end.</span></a>"}jQuery("#firm_level").html(t)},setFameLevel:function(e,t){if(typeof t==="undefined")t=0;var n='<a class="info">'+this.fameDesc[Math.min(19,Math.floor(e/5))]+'<span style="width:240px !important;">Company Fame Level: '+e+" ("+this.fameDesc[Math.min(19,Math.floor(e/5))]+")<br />";var r=parseInt(e)+1;var i=100*r*r*r;n+="Next Level: "+r+" ("+this.fameDesc[Math.min(19,Math.floor(r/5))]+")<br />Current EXP: "+t+"/"+i+"</span></a>";jQuery("#firm_fame_level").html(n)},setControl:function(e){jQuery("#firm_control").html('<a class="info">'+formatNum(e,2)+"%<span>This is the % of company stock that you currently own.</span></a>")},getCash:function(){var e={action:"get_cash"};this.executeAjax(e,function(e){firmController.setCash(e.cash,e.allowance)})},getAll:function(){var e={action:"get_all"};this.executeAjax(e,function(e){firmController.setCash(e.cash,e.allowance);firmController.setLoan(e.loan);firmController.setNetworth(e.networth);firmController.setLevel(e.level);firmController.setFameLevel(e.fame_level,e.fame_exp)})},transferCash:function(){clearTimeout(checkXFundTimeout);var e=document.getElementById("xfund").value;var t={action:"transfer_cash",xfund:e};this.executeAjax(t,function(e){jQuery("#transfer_cash_form").html(e.msg);firmController.setCash(e.firm_cash_new,firmController.allowance);playerController.setCash(e.player_cash_new)})},obtainLoan:function(){clearTimeout(checkXFundTimeout);var e=document.getElementById("xfund").value;var t={action:"obtain_loan",xfund:e};this.executeAjax(t,function(e){jQuery("#obtain_loan_form").html(e.msg);firmController.setCash(e.firm_cash_new,firmController.allowance);firmController.setLoan(e.firm_loan_new)})},repayLoan:function(){clearTimeout(checkXFundTimeout);var e=document.getElementById("xfund").value;var t={action:"repay_loan",xfund:e};this.executeAjax(t,function(e){jQuery("#repay_loan_form").html(e.msg);firmController.setCash(e.firm_cash_new,firmController.allowance);firmController.setLoan(e.firm_loan_new)})},checkCompanyName:function(){var e=document.getElementById("new_firm_name").value;var t={action:"check_firm_name",name:e};jQuery.ajax({type:"POST",url:"firm_controller.php",data:t,dataType:"json",success:function(e){if(e.success){jQuery("#name_check_response").css({color:"#338033"});jQuery("#name_check_response").html(e.msg);jQuery("#f_name_submit").prop("disabled",false)}else{jQuery("#name_check_response").css({color:"#ff0000"});jQuery("#name_check_response").html(e.msg);jQuery("#f_name_submit").prop("disabled",true)}},error:function(e,t,n){console.log(e.responseText)}})},updateCompanyName:function(){clearTimeout(searchTimeout);var e=document.getElementById("new_firm_name").value;var t={action:"update_firm_name",name:e};this.executeAjax(t,function(t){var n="<h3>Name Changed</h3> 			Your company name has been changed to the following:<br /><br />";n+=e;jQuery("#f_name_form").html(n);firmController.getAll()})},updateCompanyColor:function(){var e=document.getElementById("new_firm_color").value;var t={action:"update_firm_color",color:e};this.executeAjax(t,function(e){var t="<h3>Color Changed</h3> 			Your company color has been successfully changed.";jQuery("#f_color_form").html(t)})},startNewCompany:function(){clearTimeout(searchTimeout);var e=document.getElementById("new_firm_name").value;var t={action:"start_new_firm",name:e};this.executeAjax(t,function(t){var n="<h3>Company Started</h3> 			The following company is now registered to do business:<br /><br />";n+=e;n+='<br /><br /> 			<input type="button" class="bigger_input" value="Click here to continue" onclick="document.location.reload(true);" />';jQuery("#f_new_form").html(n);firmController.getCash()})},sellCompany:function(){jConfirm("Are you absolutely sure you want to SELL THE COMPANY? You will NOT be able to get it back!","Sell Company",function(e){if(e){var t={action:"sell_firm"};firmController.executeAjax(t,function(e){var t="<h3>Company Sold</h3> 					"+e.firmName+" has been solds for "+formatNum(e.soldCash/100,2)+" after commissions and fees.";t+='<br /><br /> 					<input type="button" class="bigger_input" value="Click here to continue" onclick="document.location.reload(true);" />';jQuery("#f_sell_form").html(t)})}})},updateExecPay:function(){clearTimeout(checkSalaryTimeout);clearTimeout(checkBonusTimeout);var e=document.getElementById("salary").value;var t=document.getElementById("bonus").value;var n={action:"set_self_pay",salary:e,bonus:t};this.executeAjax(n,function(e){jQuery("#exec_pay_form").html("You have successfully changed the Chairman's salary to $"+formatNum(e.salary,0)+" and bonus to "+formatNum(e.bonus,2)+"%</b> of the company's net gains.")})},requestARaise:function(){clearTimeout(checkSalaryTimeout);clearTimeout(checkBonusTimeout);var e=document.getElementById("salary").value;var t=document.getElementById("bonus").value;var n={action:"request_a_raise",salary:e,bonus:t};this.executeAjax(n,function(e){jQuery("#exec_pay_form").html("You have successfully changed your salary requirements at the company.")})},orderAppraisal:function(){var e=jQuery("#appraisal_results");if(e.length){var t={action:"order_appraisal"};this.executeAjax(t,function(t){var n='<h3>Appraisal Results</h3> 				<span style="display:inline-block;width:150px;"><i>Current Networth:</i></span> <b>$'+formatNum(t.nw/100,2)+" ($"+formatNumReadable(t.nw/100)+')</b><br /><br /> 				<h3>Details:</h3> 				<span style="display:inline-block;width:150px;">Cash: </span> 				$<span style="display:inline-block;width:200px;text-align:right;">'+formatNum(t.cash/100,2)+'</span><br /> 				<span style="display:inline-block;width:150px;">Loan: </span> 				$<span style="display:inline-block;width:200px;text-align:right;color:#ff0000;">-'+formatNum(t.loan/100,2)+'</span><br /> 				<span style="display:inline-block;width:150px;">Fame: </span> 				$<span style="display:inline-block;width:200px;text-align:right;">'+formatNum(t.fame/100,2)+'</span><br /> 				<span style="display:inline-block;width:150px;">Land Value: </span> 				$<span style="display:inline-block;width:200px;text-align:right;">'+formatNum(t.land/100,2)+'</span><br /> 				<span style="display:inline-block;width:150px;">Building Value: </span> 				$<span style="display:inline-block;width:200px;text-align:right;">'+formatNum(t.bldg/100,2)+'</span><br /> 				<span style="display:inline-block;width:150px;">Research Value: </span> 				$<span style="display:inline-block;width:200px;text-align:right;">'+formatNum(t.res/100,2)+'</span><br /> 				<span style="display:inline-block;width:150px;">Warehouse Inven.: </span> 				$<span style="display:inline-block;width:200px;text-align:right;">'+formatNum(t.wh/100,2)+'</span><br /> 				<span style="display:inline-block;width:150px;">Market Inven.: </span> 				$<span style="display:inline-block;width:200px;text-align:right;">'+formatNum(t.market/100,2)+'</span><br /> 				<br /> 				<span style="display:inline-block;width:150px;">Total Networth.: </span> 				$<span style="display:inline-block;width:200px;text-align:right;">'+formatNum(t.nw/100,2)+"</span><br /> 				";e.html(n);firmController.getAll()})}},toggleNextAcceptance:function(e){var t={action:"toggle_next_acceptance",player_id:e};this.executeAjax(t,function(t){if(typeof t.title!=="undefined"){jQuery("#next_acceptance_"+e).val(t.title)}})},fireEmployee:function(e){jConfirm("Are you sure about this? Maybe this person is just having a really bad time?","Fire Employee",function(t){if(t){var n={action:"fire_employee",player_id:e};firmController.executeAjax(n,function(t){jQuery("#employee_display_"+e).fadeOut(500)})}})},quitJob:function(){jConfirm("Are you sure about this? People who do this generally are NOT invited back!","Quit Job",function(e){if(e){var t={action:"quit_job"};firmController.executeAjax(t,function(e){var t='<h3>A New Start</h3> 						Your boss respects your decision, and once again you are on your own.<br /><br /> 						<input type="button" class="bigger_input" value="Click here to continue" onclick="document.location.reload(true);" />';jQuery("#quit_job_form").html(t)})}})}};var marketController={lastDivId:0,lastRan:0,executeAjax:function(e,t){jQuery.ajax({type:"POST",url:"market_controller.php",data:e,dataType:"json",success:function(e){if(e.success){if(typeof t==="function"){t(e)}}else{if(typeof e.msg!=="undefined"&&e.msg){jAlert(e.msg)}else{jAlert("Something went wrong")}}},error:function(e,t,n){console.log(e.responseText)}})},showTable:function(e,t,n,r){if(typeof n==="undefined")n=0;if(typeof r==="undefined")r=0;var i={action:"show_table",page_num:e,view_type:t,view_type_id:n};this.executeAjax(i,function(e){if(typeof e.needTypeId!=="undefined"&&e.needTypeId){var i="";if(e.typeResults.length){var s=t;var o="type_id_item";if(t=="cat"){s=t+"/large";o="type_id_item cat"}for(var u in e.typeResults){var a=e.typeResults[u];i+='<div class="'+o+'"><a href="market.php?view_type='+t+"&view_type_id="+a.id+'" title="'+a.name+'"><img src="/eos/images/'+s+"/"+a.name.toLowerCase().replace(/[\s\&\']/g,"_").replace(/_{2,}/g,"_")+'.gif" /><br />'+a.name+"</a></div>"}}else{i='No listings found. <a class="jqDialog" href="/eos/market-add-request.php">Would you like to add a request?</a>'}document.getElementById("b2b_table").style.display="none";jQuery(".b2b_nav_container").html("");document.getElementById("type_id_choices").style.display="";jQuery("#type_id_choices").html(i)}else{var f=Math.ceil(e.totalItems/e.perPage);marketController.showMenu(e.pageNum,f,"'"+t+"', '"+n+"'");var l='				<thead> 					<tr> 						<td colspan="2">Product</td><td>Quality</td><td>Quantity</td><td>Unit Price</td><td>Total Price</td><td>Buy Quantity</td><td>Actions</td> 					</tr> 				</thead> 				<tbody>';if(e.results.length){for(var u in e.results){var c=e.results[u];l+='<tr id="b2b_display_'+c.id+'" class="b2b_tr" b2b_id="'+c.id+'">';if(c.has_icon!="0"){var h=c.name.toLowerCase().replace(/[\s\&\']/g,"_").replace(/_{2,}/g,"_")}else{var h="no-icon"}l+='<td style="border-right: none;"><a class="jqDialog" href="/eos/pedia-product-view.php?pid='+c.pid+'"><img src="/eos/images/prod/'+h+'.gif" title="'+c.name+'" /></a></td><td class="market_prod_name">'+c.name+'<br /><span class="market_firm_name">by <a href="/eos/firm/'+c.fid+'" target="_blank">'+c.firm_name+"</a></span></td><td>"+formatNum(c.pidq,2,0)+"</td><td>"+formatNum(c.pidn,0,1)+"</td><td>$"+formatNumReadable(c.price/100)+"</td><td>$"+formatNumReadable(c.price*c.pidn/100)+'</td><td><input id="buy_quantity_'+c.id+'" type="text" size="8" maxlength="15" /></td>';if(c.fid==firmController.firmId){l+='<td style="text-align:left;white-space:nowrap;"><a onclick="marketController.buy('+c.id+');"><img src="/eos/images/button-trade-small.gif" title="Remove (pay 0.2% storage fee)" /></a> <a onclick="marketController.buyAll('+c.id+');"><img src="/eos/images/button-buyall-small.gif" title="Remove All (pay 0.2% storage fee)" /></a> '}else{l+='<td style="text-align:left;white-space:nowrap;"><a onclick="marketController.buy('+c.id+');"><img src="/eos/images/button-trade-small.gif" title="Buy" /></a> <a onclick="marketController.buyAll('+c.id+');"><img src="/eos/images/button-buyall-small.gif" title="Buy All" /></a> '}l+='<a href="/eos/market.php?view_type=prod&view_type_id='+c.pid+'"><img class="blank_button_small" src="/eos/images/prod/'+h+'.gif" title="View All Listings of '+c.name+'" /></a>';if(c.fid==firmController.firmId){l+=' <a onclick="marketController.relist('+c.id+", '"+c.name+"', "+c.price+", "+c.pidn+');"><img src="/eos/images/button-sell-small.gif" title="Re-List with New Price" /></a>'}else{l+=' <a href="/eos/market.php?view_type=firm&view_type_id='+c.fid+'"><img src="/eos/images/button-firm-small.gif" title="View All Listings from '+c.firm_name+'" /></a>'}l+="</td></tr>"}}else{l+='					<tr><td colspan="8">No listings found. <a class="jqDialog" href="/eos/market-add-request.php">Would you like to add a request?</a></td></tr>'}l+="				</tbody>";document.getElementById("type_id_choices").style.display="none";document.getElementById("b2b_table").style.display="";jQuery("#b2b_table").html(l);if(!r){document.getElementById("b2b_submenu").scrollIntoView()}}})},refreshRow:function(e){var t={action:"refresh_row",b2b_id:e};marketController.executeAjax(t,function(t){if(t.notFound==1){jQuery("#b2b_display_"+e).fadeOut(500,function(){jQuery("#b2b_display_"+e).html('<td colspan="8"><b><i>SOLD OUT</i></b></td>').fadeIn(500)})}else{var n="";var r=t.resultRow;if(r.has_icon!="0"){var i=r.name.toLowerCase().replace(/[\s\&\']/g,"_").replace(/_{2,}/g,"_")}else{var i="no-icon"}n+='<td style="border-right: none;"><a class="jqDialog" href="/eos/pedia-product-view.php?pid='+r.pid+'" title="View '+r.name+' on EOS-Pedia"><img src="/eos/images/prod/'+i+'.gif" /></a></td><td class="market_prod_name">'+r.name+'<br /><span class="market_firm_name">by <a href="/eos/firm/'+r.fid+'" target="_blank">'+r.firm_name+"</a></span></td><td>"+formatNum(r.pidq,2,0)+"</td><td>"+formatNum(r.pidn,0,1)+"</td><td>$"+formatNumReadable(r.price/100)+"</td><td>$"+formatNumReadable(r.price*r.pidn/100)+'</td><td><input id="buy_quantity_'+r.id+'" type="text" size="8" maxlength="15" /></td>';if(r.fid==firmController.firmId){n+='<td style="text-align:left;white-space:nowrap;"><a onclick="marketController.buy('+r.id+');"><img src="/eos/images/button-trade-small.gif" title="Remove (pay 0.2% storage fee)" /></a> <a onclick="marketController.buyAll('+r.id+');"><img src="/eos/images/button-buyall-small.gif" title="Remove All (pay 0.2% storage fee)" /></a> '}else{n+='<td style="text-align:left;white-space:nowrap;"><a onclick="marketController.buy('+r.id+');"><img src="/eos/images/button-trade-small.gif" title="Buy" /></a> <a onclick="marketController.buyAll('+r.id+');"><img src="/eos/images/button-buyall-small.gif" title="Buy All" /></a> '}n+='<a href="/eos/market.php?view_type=prod&view_type_id='+r.pid+'"><img class="blank_button_small" src="/eos/images/prod/'+i+'.gif" title="View All Listings of '+r.name+'" /></a>';if(r.fid==firmController.firmId){n+=' <a onclick="marketController.relist('+r.id+", '"+r.name+"', "+r.price+", "+r.pidn+');"><img src="/eos/images/button-sell-small.gif" title="Re-List with New Price" /></a>'}else{n+=' <a href="/eos/market.php?view_type=firm&view_type_id='+r.fid+'"><img src="/eos/images/button-firm-small.gif" title="View All Listings from '+r.firm_name+'" /></a>'}n+="</td>";jQuery("#b2b_display_"+e).fadeOut(500,function(){jQuery("#b2b_display_"+e).html(n).fadeIn(500)})}})},showTableRequests:function(e,t,n,r){if(typeof n==="undefined")n=0;if(typeof r==="undefined")r=0;var i={action:"show_table",page_num:e,view_type:"requests_"+t,view_type_id:n};this.executeAjax(i,function(e){if(typeof e.needTypeId!=="undefined"&&e.needTypeId){var i="";if(e.typeResults.length){var s=t;var o="type_id_item";if(t=="cat"){s=t+"/large";o="type_id_item cat"}for(var u in e.typeResults){var a=e.typeResults[u];i+='<div class="'+o+'"><a href="market-requests.php?view_type='+t+"&view_type_id="+a.id+'" title="'+a.name+'"><img src="/eos/images/'+s+"/"+a.name.toLowerCase().replace(/[\s\&\']/g,"_").replace(/_{2,}/g,"_")+'.gif" /><br />'+a.name+"</a></div>"}}else{i="No requests found."}document.getElementById("b2b_table").style.display="none";jQuery(".b2b_nav_container").html("");document.getElementById("type_id_choices").style.display="";jQuery("#type_id_choices").html(i)}else{var f=Math.ceil(e.totalItems/e.perPage);marketController.showMenu(e.pageNum,f,"'"+t+"', '"+n+"'","showTableRequests");var l='				<thead> 					<tr> 						<td colspan="2">Requested Product</td><td>Min. Quality</td><td>Requested Quantity</td><td>Unit Price</td><td>Quantity to Sell</td><td>Actions</td> 					</tr> 				</thead> 				<tbody>';if(e.results.length){for(var u in e.results){var c=e.results[u];l+='<tr id="b2b_display_'+c.id+'" class="b2b_tr" b2b_id="'+c.id+'">';if(c.has_icon!="0"){var h=c.name.toLowerCase().replace(/[\s\&\']/g,"_").replace(/_{2,}/g,"_")}else{var h="no-icon"}l+='<td style="border-right: none;"><a class="jqDialog" href="/eos/pedia-product-view.php?pid='+c.pid+'" title="View '+c.name+' on EOS-Pedia"><img src="/eos/images/prod/'+h+'.gif" /></a></td><td class="market_prod_name">'+c.name+'<br /><span class="market_firm_name">by <a href="/eos/firm/'+c.fid+'" target="_blank">'+c.firm_name+"</a></span></td><td>"+formatNum(c.pidq,2,0)+"</td>";if(c.pidn==-1){l+="<td><i>Unlimited</i></td>"}else{l+="<td>"+formatNum(c.pidn,0,1)+"</td>"}l+="<td>$"+formatNumReadable(c.price/100)+"</td>";if(c.aon!="0"){if(parseInt(c.owned)>parseInt(c.pidn)){l+='<td><a class="market_aon pidn_met info">'+c.pidn+"<br />(AON)<span>All Or None</span></a></td>"}else{l+='<td><a class="market_aon info">'+c.pidn+"<br />(AON)<span>All Or None</span></a></td>"}}else if(c.owned=="0"){l+='<td><input id="sell_quantity_'+c.id+'" type="text" size="8" maxlength="15" disabled="disabled" /></td>'}else{l+='<td><input id="sell_quantity_'+c.id+'" type="text" size="8" maxlength="15" /></td>'}l+='<td style="text-align:left;white-space:nowrap;">';if(c.owned!="0"){if(c.aon=="0"){l+='<a onclick="marketController.sell('+c.id+');"><img src="/eos/images/button-trade-small.gif" title="Sell" /></a> ';l+='<a onclick="marketController.sellAll('+c.id+');"><img src="/eos/images/button-buyall-small.gif" title="Sell All" /></a> '}else if(parseInt(c.owned)>=parseInt(c.pidn)){l+='<a onclick="marketController.sellAll('+c.id+');"><img src="/eos/images/button-buyall-small.gif" title="Sell All" /></a> '}}l+='<a href="/eos/market-requests.php?view_type=prod&view_type_id='+c.pid+'"><img class="blank_button_small" src="/eos/images/prod/'+h+'.gif" title="View All Requests of '+c.name+'" /></a>';if(c.fid==firmController.firmId){l+=' <a onclick="marketController.cancelRequest('+c.id+", '"+c.name+"', "+c.price+", "+c.pidn+');"><img src="/eos/images/button-trash-small.gif" title="Cancel and Remove Request" /></a>'}else{l+=' <a href="/eos/market-requests.php?view_type=firm&view_type_id='+c.fid+'"><img src="/eos/images/button-firm-small.gif" title="View All Requests from '+c.firm_name+'" /></a>'}l+="</td></tr>"}}else{l+='					<tr><td colspan="8">No requests found.</td></tr>'}l+="				</tbody>";jQuery("#b2b_table").html(l);if(!r){document.getElementById("b2b_submenu").scrollIntoView()}}})},refreshRowRequests:function(e){var t={action:"refresh_row_requests",b2b_id:e};marketController.executeAjax(t,function(t){if(t.notFound==1){jQuery("#b2b_display_"+e).fadeOut(500,function(){jQuery("#b2b_display_"+e).html('<td colspan="8"><b><i>REQUEST FULFILLED</i></b></td>').fadeIn(500)})}else{var n="";var r=t.resultRow;if(r.has_icon!="0"){var i=r.name.toLowerCase().replace(/[\s\&\']/g,"_").replace(/_{2,}/g,"_")}else{var i="no-icon"}n+='<td style="border-right: none;"><a class="jqDialog" href="/eos/pedia-product-view.php?pid='+r.pid+'" title="View '+r.name+' on EOS-Pedia"><img src="/eos/images/prod/'+i+'.gif" /></a></td><td class="market_prod_name">'+r.name+'<br /><span class="market_firm_name">by <a href="/eos/firm/'+r.fid+'" target="_blank">'+r.firm_name+"</a></span></td><td>"+formatNum(r.pidq,2,0)+"</td>";if(r.pidn==-1){n+="<td><i>Unlimited</i></td>"}else{n+="<td>"+formatNum(r.pidn,0,1)+"</td>"}n+="<td>$"+formatNumReadable(r.price/100)+"</td>";if(r.aon!="0"){if(parseInt(r.owned)>parseInt(r.pidn)){n+='<td><a class="market_aon pidn_met info">'+r.pidn+"<br />(AON)<span>All Or None</span></a></td>"}else{n+='<td><a class="market_aon info">'+r.pidn+"<br />(AON)<span>All Or None</span></a></td>"}}else if(r.owned=="0"){n+='<td><input id="sell_quantity_'+r.id+'" type="text" size="8" maxlength="15" disabled="disabled" /></td>'}else{n+='<td><input id="sell_quantity_'+r.id+'" type="text" size="8" maxlength="15" /></td>'}n+='<td style="text-align:left;white-space:nowrap;">';if(r.owned!="0"){if(r.aon=="0"){n+='<a onclick="marketController.sell('+r.id+');"><img src="/eos/images/button-trade-small.gif" title="Sell" /></a> ';n+='<a onclick="marketController.sellAll('+r.id+');"><img src="/eos/images/button-buyall-small.gif" title="Sell All" /></a> '}else if(parseInt(r.owned)>=parseInt(r.pidn)){n+='<a onclick="marketController.sellAll('+r.id+');"><img src="/eos/images/button-buyall-small.gif" title="Sell All" /></a> '}}n+='<a href="/eos/market-requests.php?view_type=prod&view_type_id='+r.pid+'"><img class="blank_button_small" src="/eos/images/prod/'+i+'.gif" title="View All Requests of '+r.name+'" /></a>';if(r.fid==firmController.firmId){n+=' <a onclick="marketController.cancelRequest('+r.id+", '"+r.name+"', "+r.price+", "+r.pidn+');"><img src="/eos/images/button-trash-small.gif" title="Cancel and Remove Request" /></a>'}else{n+=' <a href="/eos/market-requests.php?view_type=firm&view_type_id='+r.fid+'"><img src="/eos/images/button-firm-small.gif" title="View All Requests from '+r.firm_name+'" /></a>'}n+="</td>";jQuery("#b2b_display_"+e).fadeOut(500,function(){jQuery("#b2b_display_"+e).html(n).fadeIn(500)})}})},showTableHistory:function(e,t,n,r,i){if(typeof r==="undefined")r=0;if(typeof i==="undefined")i=0;var s={action:"show_table",page_num:e,view_type:t,target_fid:n,view_type_id:r};this.executeAjax(s,function(e){var s=Math.ceil(e.totalItems/e.perPage);marketController.showMenu(e.pageNum,s,"'"+t+"', "+n+", '"+r+"'","showTableHistory");var o='			<thead> 				<tr> 					<td colspan="2">Product</td><td>Quality</td><td>Purchased Quantity</td><td>Unit Price</td><td>Total Price</td><td>Purchase Time</td> 				</tr> 			</thead> 			<tbody>';if(e.results.length){for(var u in e.results){var a=e.results[u];if(a.hide!="0"){o+='<tr id="b2b_display_'+a.id+'" class="b2b_tr" b2b_id="'+a.id+'">'}else{o+='<tr id="b2b_display_'+a.id+'" class="b2b_tr flagged" b2b_id="'+a.id+'">'}if(a.has_icon!="0"){var f=a.name.toLowerCase().replace(/[\s\&\']/g,"_").replace(/_{2,}/g,"_")}else{var f="no-icon"}o+='<td style="border-right: none;"><a class="jqDialog" href="/eos/pedia-product-view.php?pid='+a.pid+'" title="View '+a.name+' on EOS-Pedia"><img src="/eos/images/prod/'+f+'.gif" /></a></td><td class="market_prod_name">'+a.name+'<br /><span class="market_firm_name">by <a href="/eos/firm/'+a.sfid+'" target="_blank">'+a.sf_name+"</a></span></td><td>"+formatNum(a.pidq,2,0)+"</td><td>"+formatNum(a.pidn,0,1)+"</td><td>$"+formatNumReadable(a.price/100)+"</td><td>$"+formatNumReadable(a.price*a.pidn/100)+"</td>";o+="<td>"+moment(a.transaction_time).format("MMM D, hh:mm A")+'<br /><span class="market_firm_name">by <a href="/eos/firm/'+a.bfid+'" target="_blank">'+a.bf_name+"</a></span></td></tr>"}}else{o+='				<tr><td colspan="8">No history found.</td></tr>'}o+="			</tbody>";jQuery("#b2b_table").html(o);if(!i){document.getElementById("b2b_submenu").scrollIntoView()}})},showMenu:function(e,t,n,r){var i="";var s;if(typeof r==="undefined")r="showTable";if(t>1){if(e>1){s=e-1;i+='<div class="table_nav"> <a onclick="marketController.'+r+"("+s+", "+n+')">Prev</a> '}else{i+='<div class="table_nav"> <a class="disabled">Prev</a> '}for(var o=1;o<=t;o++){if(o-e>=10||e-o>=5){if(o-e==10||e-o==5){i+=' <a onclick="marketController.'+r+"("+o+", "+n+')">...</a> '}}else{if(o!=e){i+=' <a onclick="marketController.'+r+"("+o+", "+n+')">'+o+"</a> "}else{i+=' <a class="selected" onclick="marketController.'+r+"("+o+", "+n+')">'+o+"</a> "}}}if(e<t){s=e+1;i+=' <a onclick="marketController.'+r+"("+s+", "+n+')">Next</a> </div>'}else{i+=' <a class="disabled">Next</a> </div>'}}jQuery(".b2b_nav_container").html(i)},buy:function(e,t){if(typeof t==="undefined")t=0;var n=Math.floor(stripCommas(document.getElementById("buy_quantity_"+e).value));var r=(new Date).valueOf()*.01|0;var i=r-marketController.lastRan;if(marketController.lastDivId==e&&i<15){return false}marketController.lastDivId=e;marketController.lastRan=r;var s={action:"buy",b2b_id:e,buy_num:n,force_buy:t};marketController.executeAjax(s,function(t){if(typeof t.confNeeded!=="undefined"&&t.confNeeded){jConfirm(t.confMsg,"Confirmation Needed",function(t){if(t){marketController.buy(e,1)}})}else{jQuery("#b2b_display_"+e).fadeOut(500,function(){jQuery("#b2b_display_"+e).html('<td colspan="8">'+t.msg+"</td>").fadeIn(500,function(){firmController.getCash();setTimeout("marketController.refreshRow("+e+");",3e3)})})}})},buyAll:function(e){var t=(new Date).valueOf()*.01|0;var n=t-marketController.lastRan;if(marketController.lastDivId==e&&n<15){return false}marketController.lastDivId=e;marketController.lastRan=t;var r={action:"buy_all",b2b_id:e};marketController.executeAjax(r,function(t){jQuery("#b2b_display_"+e).fadeOut(500,function(){jQuery("#b2b_display_"+e).html('<td colspan="8">'+t.msg+"</td>").fadeIn(500,function(){firmController.getCash();setTimeout(function(){jQuery("#b2b_display_"+e).fadeOut(500,function(){jQuery("#b2b_display_"+e).html('<td colspan="8"><b><i>SOLD OUT</i></b></td>').fadeIn(500)})},3e3)})})})},sell:function(e){var t=Math.floor(stripCommas(document.getElementById("sell_quantity_"+e).value));var n=(new Date).valueOf()*.01|0;var r=n-marketController.lastRan;if(marketController.lastDivId==e&&r<15){return false}marketController.lastDivId=e;marketController.lastRan=n;var i={action:"sell",b2b_id:e,sell_num:t};marketController.executeAjax(i,function(t){jQuery("#b2b_display_"+e).fadeOut(500,function(){jQuery("#b2b_display_"+e).html('<td colspan="8">'+t.msg+"</td>").fadeIn(500,function(){firmController.getCash();setTimeout("marketController.refreshRowRequests("+e+");",3e3)})})})},sellAll:function(e){var t=(new Date).valueOf()*.01|0;var n=t-marketController.lastRan;if(marketController.lastDivId==e&&n<15){return false}marketController.lastDivId=e;marketController.lastRan=t;var r={action:"sell_all",b2b_id:e};marketController.executeAjax(r,function(t){jQuery("#b2b_display_"+e).fadeOut(500,function(){jQuery("#b2b_display_"+e).html('<td colspan="8">'+t.msg+"</td>").fadeIn(500,function(){firmController.getCash();setTimeout("marketController.refreshRowRequests("+e+");",3e3)})})})},cancelRequest:function(e){var t=(new Date).valueOf()*.01|0;var n=t-marketController.lastRan;if(marketController.lastDivId==e&&n<15){return false}marketController.lastDivId=e;marketController.lastRan=t;var r={action:"cancel_request",b2b_id:e};marketController.executeAjax(r,function(t){jQuery("#b2b_display_"+e).fadeOut(500,function(){jQuery("#b2b_display_"+e).html('<td colspan="8"><i>'+t.msg+"</i></td>").fadeIn(500)})})},relist:function(e,t,n,r){if(r==1){var i="Currently listed is 1 unit of "+t+"(s) at $"}else{var i="Currently listed are "+r+" units of "+t+"(s) at $"}jPrompt(i+formatNum(n/100,2)+" each, a 2% re-listing fee of $"+formatNumReadable(Math.ceil(2/1e4*n*r))+" will apply.<br /><br />Input new price ($) to re-list.",formatNum(n/100,2),"Re-list "+t+"(s)",function(t){if(t!=""&&t>0){t=Math.round(stripCommas(t)*100);var n={action:"relist",b2b_id:e,new_price:t};marketController.executeAjax(n,function(t){jQuery("#b2b_display_"+e).fadeOut(500,function(){jQuery("#b2b_display_"+e).html('<td colspan="8">'+t.msg+"</td>").fadeIn(500);firmController.getCash()})})}})}};var messagesController={currPage:1,currViewType:"",currViewTypeId:0,executeAjax:function(e,t){jQuery.ajax({type:"POST",url:"messages_controller.php",data:e,dataType:"json",success:function(e){if(e.success){if(typeof t==="function"){t(e)}}else{if(typeof e.msg!=="undefined"&&e.msg){jAlert(e.msg)}else{jAlert("Something went wrong")}}},error:function(e,t,n){console.log(e.responseText)}})},showTable:function(e,t,n,r){if(typeof r==="undefined")r=0;var i={action:"show_table",page_num:e,view_type:t,view_type_id:n};this.executeAjax(i,function(e){var i=Math.ceil(e.totalItems/e.perPage);messagesController.currPage=e.pageNum;messagesController.currViewType=t;messagesController.currViewTypeId=n;messagesController.showMenu(e.pageNum,i,"'"+t+"', '"+n+"'","showTable");var s="			<thead> 				<tr>";var o=4;s+='<td style="width:24px;"></td>';if(t=="received"||t=="notes"){s+='<td style="width:24px;"></td>'}if(t=="received"){s+='<td style="width:130px;">Sender</td>';o=5}if(t=="sent"){s+='<td style="width:130px;">Recipient</td>'}s+='<td>Subject</td> 					<td style="width:100px;">Actions</td> 				</tr> 			</thead> 			<tbody>';if(e.results.length){for(var u in e.results){var a=e.results[u];var f="";var l="";var c=a.recipient_read;if(t=="received"||t=="notes"){var h="message_importance";if(a.recipient_starred!="0")h="message_importance important";l='<td><div id="message_importance_'+a.id+'" class="'+h+'" onclick="messagesController.toggleImportance('+a.id+')"></div></td>'}if(t=="received"){f='<td><a href="/eos/player/'+a.sender_id+'">'+a.sender_name+"</a></td>"}if(t=="sent"){c=1;f='<td><a href="/eos/player/'+a.recipient_id+'">'+a.recipient_name+"</a></td>"}var p="unread";if(c!="0")p="read";if(a.no_delete!="0"){var d='<img src="/eos/images/button-trash-small-inactive.gif" title="Cannot Delete" />'}else{var d='<a onclick="messagesController.deleteMessage('+a.id+')"><img src="/eos/images/button-trash-small.gif" title="Delete" /></a>'}s+='<tr id="messages_display_'+a.id+'" class="'+p+'"><td><input id="messages_cb_'+a.id+'" class="bigger_input messages_cb" type="checkbox" value="'+a.id+'" /><label for="messages_cb_'+a.id+'"></label></td>'+l+f+'<td><a onclick="messagesController.viewMessage('+a.id+')">'+a.subject+'</a></td><td><a href="messages.php?action=write&reply_to='+a.id+'"><img src="/eos/images/mail_reply.png" width="24px" height="24px" alt="[Reply]" title="Reply" /></a> '+d+"</td></tr>"}document.getElementById("messages_table_actions").style.display=""}else{s+='<tr><td colspan="'+o+'"><center>No message.</center></td></tr>';document.getElementById("messages_table_actions").style.display="none"}s+="			</tbody>";jQuery("#messages_table").html(s);if(!r){document.getElementById("messages_submenu").scrollIntoView()}})},showContacts:function(e,t,n){if(typeof t==="undefined")t="all";if(typeof n==="undefined")n=0;var r={action:"show_contacts",page_num:e,view_type:t};this.executeAjax(r,function(e){var r=Math.ceil(e.totalItems/e.perPage);messagesController.showMenu(e.pageNum,r,"'"+t+"'","showContacts");var i='			<thead> 				<tr> 					<td><span title="Status">S</span></td> 					<td>Player</td> 					<td>Active Company</td> 					<td width="40%">Notes</td> 					<td width="90">Actions</td> 				</tr> 			</thead> 			<tbody>';if(e.results.length){for(var s in e.results){var o=e.results[s];var u=moment().unix()-moment(o.last_active).unix();if(u<60){var a='<a class="info"><img src="/eos/images/icon-status-green.gif" /><span>Currently Online</span></a>'}else if(u<900){var a='<a class="info"><img src="/eos/images/icon-status-green.gif" /><span>Active within 5 minutes</span></a>'}else if(u<86400){if(moment().format("D")!=moment(o.last_active).format("D")){var f="Yesterday at "+moment(o.last_active).format("hh:mm A")}else{var f="Today at "+moment(o.last_active).format("hh:mm A")}var a='<a class="info"><img src="/eos/images/icon-status-yellow.gif" /><span>Last seen: <br />'+f+"</span></a>"}else if(u<604800){var f=moment(o.last_active).format("MMM D, YYYY");var a='<a class="info"><img src="/eos/images/icon-status-red.gif" /><span>Last seen on: <br />'+f+"</span></a>"}else{var f=moment(o.last_active).format("MMM D, YYYY");var a='<a class="info"><img src="/eos/images/icon-status-gray.gif" /><span>Last seen on: <br />'+f+"</span></a>"}if(o.id!="0"){var l='<a href="/eos/firm/'+o.id+'">'+o.name+"</a>"}else{var l="<i>N/A</i>"}i+='<tr id="contact_display_'+o.player_id+'"><td>'+a+'</td><td><a href="/eos/player/'+o.player_id+'"><span id="pc_'+o.player_id+'_name">'+o.player_name+"</span></a></td><td>"+l+'</td> 					<td><span id="pc_'+o.player_id+'_desc">'+o.u_notes+'</span></td> 					<td><a href="messages.php?action=write&recipient_id='+o.player_id+'"><img height="24" width="24" title="Write to '+o.player_name+'" src="/eos/images/mail_write.png" alt="[Write]" /></a> 					<a style="cursor:pointer;" onclick="messagesController.initEditContact('+o.player_id+');"><img height="24" width="24" title="Edit notes on '+o.player_name+'" src="/eos/images/edit.gif" alt="[Edit]" /></a> 					<a style="cursor:pointer;" onclick="messagesController.deleteContact('+o.player_id+');"><img height="24" width="24" title="Delete from contact list" src="/eos/images/x.gif" alt="[Del]"/></a></td></tr>'}}else{i+='				<tr><td colspan="5">No contacts available.</td></tr>'}i+="			</tbody>";jQuery("#messages_table").html(i);if(!n){document.getElementById("messages_submenu").scrollIntoView()}})},showMenu:function(e,t,n,r){var i="";var s;if(typeof r==="undefined")r="showTable";if(t>1){if(e>1){s=e-1;i+='<div class="table_nav"> <a onclick="messagesController.'+r+"("+s+", "+n+')">Prev</a> '}else{i+='<div class="table_nav"> <a class="disabled">Prev</a> '}for(var o=1;o<=t;o++){if(o!=e){i+=' <a onclick="messagesController.'+r+"("+o+", "+n+')">'+o+"</a> "}else{i+=' <a class="selected" onclick="messagesController.'+r+"("+o+", "+n+')">'+o+"</a> "}}if(e<t){s=e+1;i+=' <a onclick="messagesController.'+r+"("+s+", "+n+')">Next</a> </div>'}else{i+=' <a class="disabled">Next</a> </div>'}}jQuery(".messages_nav_container").html(i)},showPlayerFinder:function(e){if(typeof e==="undefined")e="";jqDialogInit("messages-find-player.php",{fill_target:e})},findPlayers:function(e){var t={action:"find_players",search_name:e};this.executeAjax(t,function(e){var t="			<thead> 				<tr> 					<td>Player</td> 					<td>Company</td> 					<td>Use</td> 				</tr> 			</thead> 			<tbody>";if(e.results.length){var n=0,r="";for(var i in e.results){var s=e.results[i];if(s.id!=n){if(n!=0){t+='</td><td><a title="Choose this player as recipient" onclick="fillPN(\''+r+'\')"><input type="button" class="bigger_input" value="Select" /></a></td></tr>'}n=s.id;r=s.player_name;t+='<tr> 						<td><a href="/eos/player/'+s.id+'" target="_blank">'+s.player_name+"</a></td> 						<td>"}t+='<a href="/eos/firm/'+s.fid+'" target="_blank">'+s.firm_name+"</a><br />"}t+='</td><td><a title="Choose this player as recipient" onclick="fillPN(\''+r+'\')"><input type="button" class="bigger_input" value="Select" /></a></td></tr>'}else{t+='				<tr><td colspan="3">No result</td></tr>'}t+="			</tbody>";jQuery("#players_table").html(t)})},viewMessage:function(e){jQuery("#messages_display_"+e).removeClass("unread");jQuery("#messages_display_"+e).addClass("read");var t={message_id:e};jqDialogInit("messages-view.php",t)},sendMessage:function(){var e=document.getElementById("message_recipient").value;var t=document.getElementById("message_subject").value;var n=document.getElementById("message_body").value;var r={action:"send_message",message_recipient:e,message_subject:t,message_body:n};messagesController.executeAjax(r,function(e){document.getElementById("message_recipient").value="";document.getElementById("message_subject").value="";document.getElementById("message_body").value="";document.getElementById("new_message_form").style.display="none";document.getElementById("new_message_sent").style.display="";document.getElementById("new_message_sent").scrollIntoView()})},anotherMessage:function(){document.getElementById("new_message_sent").style.display="none";document.getElementById("new_message_form").style.display=""},updateContact:function(){var e=document.getElementById("contact_name").value;var t=document.getElementById("contact_desc").value;var n={action:"update_contact",contact_name:e,contact_desc:t};messagesController.executeAjax(n,function(e){if(e.contactIsNew){jAlert("Contact added.");messagesController.showContacts(1,"all",1)}else{jAlert("Contact updated.");if($("#pc_"+e.contactId+"_desc").length){$("#pc_"+e.contactId+"_desc").html(t)}}document.getElementById("contact_name").value="";document.getElementById("contact_desc").value=""})},initEditContact:function(e){document.getElementById("contact_name").value=jQuery("#pc_"+e+"_name").html();document.getElementById("contact_desc").value=jQuery("#pc_"+e+"_desc").html();document.getElementById("update_contact_form").scrollIntoView()},deleteContact:function(e){jConfirm("Delete this contact?","Confirmation Needed",function(t){if(t){var n={action:"delete_contact",contact_id:e};messagesController.executeAjax(n,function(t){jQuery("#contact_display_"+e).fadeOut(500)})}})},deleteMessage:function(e){var t={action:"delete_message",message_id:e};messagesController.executeAjax(t,function(t){jQuery("#messages_display_"+e).fadeOut(500,function(){jQuery("#messages_display_"+e).remove()})})},checkAllMessages:function(){jQuery("input.messages_cb").prop("checked",true)},unCheckAllMessages:function(){jQuery("input.messages_cb").prop("checked",false)},deleteCheckedMessages:function(){jConfirm("Delete ALL checked messages?","Confirmation Needed",function(e){if(e){var t=jQuery("input:checkbox:checked.messages_cb").map(function(){return this.value}).get();if(!t.length)return false;var n={action:"delete_all_messages",message_ids:t};messagesController.executeAjax(n,function(e){messagesController.showTable(messagesController.currPage,messagesController.currViewType,messagesController.currViewTypeId,1)})}})},toggleImportance:function(e){var t={action:"toggle_importance",message_id:e};this.executeAjax(t,function(t){if(t.important){jQuery("#message_importance_"+e).addClass("important")}else{jQuery("#message_importance_"+e).removeClass("important")}})}};var modalController={modalCdt:null,backLink:"",backLinkTitle:""};var pediaController={executeAjax:function(e,t){jQuery.ajax({type:"POST",url:"pedia_controller.php",data:e,dataType:"json",success:function(e){if(e.success){if(typeof t==="function"){t(e)}}else{if(typeof e.msg!=="undefined"&&e.msg){jAlert(e.msg)}else{jAlert("Something went wrong")}}},error:function(e,t,n){console.log(e.responseText)}})},showTable:function(e,t,n,r,i,s){if(typeof n==="undefined")n=0;if(typeof s==="undefined")s=0;var o={action:"show_table",page_num:e,view_type:t,sort_type:r,sort_asc:i,view_type_id:n};this.executeAjax(o,function(e){if(typeof e.suggestSearch!=="undefined"&&e.suggestSearch){document.getElementById("suggest_search").style.display=""}else{document.getElementById("suggest_search").style.display="none"}if(typeof e.needTypeId!=="undefined"&&e.needTypeId){var o="";if(e.typeResults.length){if(t=="buildings_search"){for(var u in e.typeResults){var a=e.typeResults[u];o+='<div class="type_id_item"><a href="pedia.php?view_type='+t+"&view_type_id="+a.id+'" title="'+a.name+'"><img src="/eos/images/'+a.bldg_type+"/"+a.name.toLowerCase().replace(/[\s\&\']/g,"_").replace(/_{2,}/g,"_")+'.gif" /><br />'+a.name+"</a></div>"}}else{if(t=="cats_search")t="cat";var f=t;var l="type_id_item";if(t=="cat"){f=t+"/large";l="type_id_item cat"}for(var u in e.typeResults){var a=e.typeResults[u];o+='<div class="'+l+'"><a href="pedia.php?view_type='+t+"&view_type_id="+a.id+'" title="'+a.name+'"><img src="/eos/images/'+f+"/"+a.name.toLowerCase().replace(/[\s\&\']/g,"_").replace(/_{2,}/g,"_")+'.gif" /><br />'+a.name+"</a></div>"}}}else{o="No entries found."}document.getElementById("pedia_table").style.display="none";jQuery(".pedia_nav_container").html("");document.getElementById("type_id_choices").style.display="";jQuery("#type_id_choices").html(o)}else{var c=Math.ceil(e.totalItems/e.perPage);pediaController.showMenu(e.pageNum,c,"'"+t+"', '"+n+"', '"+r+"', '"+i+"'");var h='				<thead> 					<tr> 						<td colspan="2">Product</td>';if(r=="value"&&i==1){h+="<td><a onclick=\"pediaController.showTable(1, '"+t+"', '"+n+"', 'value', 0)\">Base Value</a></td>"}else{h+="<td><a onclick=\"pediaController.showTable(1, '"+t+"', '"+n+"', 'value', 1)\">Base Value</a></td>"}if(r=="price"&&i==1){h+="<td><a onclick=\"pediaController.showTable(1, '"+t+"', '"+n+"', 'price', 0)\">Average Store Price</a></td>"}else{h+="<td><a onclick=\"pediaController.showTable(1, '"+t+"', '"+n+"', 'price', 1)\">Average Store Price</a></td>"}if(r=="quality"&&i==1){h+="<td><a onclick=\"pediaController.showTable(1, '"+t+"', '"+n+"', 'quality', 0)\">Average Quality*</a></td>"}else{h+="<td><a onclick=\"pediaController.showTable(1, '"+t+"', '"+n+"', 'quality', 1)\">Average Quality*</a></td>"}if(r=="tech"&&i==1){h+="<td><a onclick=\"pediaController.showTable(1, '"+t+"', '"+n+"', 'tech', 0)\">Leading Tech**</a></td>"}else{h+="<td><a onclick=\"pediaController.showTable(1, '"+t+"', '"+n+"', 'tech', 1)\">Leading Tech**</a></td>"}h+="<td>Units Sold</td><td>Units Demanded</td>";if(r=="demand_met"&&i==1){h+="<td><a onclick=\"pediaController.showTable(1, '"+t+"', '"+n+"', 'demand_met', 0)\">% Demand Met</a></td>"}else{h+="<td><a onclick=\"pediaController.showTable(1, '"+t+"', '"+n+"', 'demand_met', 1)\">% Demand Met</a></td>"}h+="					</tr> 				</thead> 				<tbody>";if(e.results.length){for(var u in e.results){var p=e.results[u];h+='<tr id="pedia_display_'+p.id+'" class="pedia_tr" pedia_id="'+p.id+'">';if(p.has_icon!="0"){var d=p.name.toLowerCase().replace(/[\s\&\']/g,"_").replace(/_{2,}/g,"_")}else{var d="no-icon"}h+='<td style="border-right: none;"><a class="jqDialog" href="/eos/pedia-product-view.php?pid='+p.id+'"><img src="/eos/images/prod/'+d+'.gif" title="'+p.name+'" /></a></td><td class="pedia_prod_name">'+p.name+"</td><td>$"+formatNumReadable(p.value/100)+"</td>";if(p.sellable!="0"){h+="<td>$"+formatNumReadable(p.value_avg/100)+"</td><td>"+formatNum(p.q_avg,1)+"</td>"}else{h+="<td>N/A</td><td>N/A</td>"}h+="<td>"+formatNum(p.tech_avg,1)+"</td>";if(p.sellable!="0"){var v=Math.floor(p.demand/p.value_avg);var m=Math.floor(v*p.demand_met);h+="<td>"+formatNumReadable(m)+"</td><td>"+formatNumReadable(v)+"</td>";if(p.demand_met>1){h+='<td><span style="color:#c00000;">'+formatNum(p.demand_met*100,2)+"%</span></td>"}else if(p.demand_met>.5){h+="<td>"+formatNum(p.demand_met*100,2)+"%</td>"}else{h+='<td><span style="color:#008000;">'+formatNum(p.demand_met*100,2)+"%</span></td>"}}else{h+="<td>N/A</td><td>N/A</td><td>N/A</td>"}h+="</tr>"}}else{h+='					<tr><td colspan="9">No entries found.</td></tr>'}h+="				</tbody>";document.getElementById("type_id_choices").style.display="none";document.getElementById("pedia_table").style.display="";jQuery("#pedia_table").html(h);if(!s){document.getElementById("pedia_submenu").scrollIntoView()}}})},showMenu:function(e,t,n,r){var i="";var s;if(typeof r==="undefined")r="showTable";if(t>1){if(e>1){s=e-1;i+='<div class="table_nav"> <a onclick="pediaController.'+r+"("+s+", "+n+')">Prev</a> '}else{i+='<div class="table_nav"> <a class="disabled">Prev</a> '}for(var o=1;o<=t;o++){if(o!=e){i+=' <a onclick="pediaController.'+r+"("+o+", "+n+')">'+o+"</a> "}else{i+=' <a class="selected" onclick="pediaController.'+r+"("+o+", "+n+')">'+o+"</a> "}}if(e<t){s=e+1;i+=' <a onclick="pediaController.'+r+"("+s+", "+n+')">Next</a> </div>'}else{i+=' <a class="disabled">Next</a> </div>'}}jQuery(".pedia_nav_container").html(i)}};var playerController={playerId:0,playerName:"You",executeAjax:function(e,t){jQuery.ajax({type:"POST",url:"player_controller.php",data:e,dataType:"json",success:function(e){if(e.success){if(typeof t==="function"){t(e)}}else{if(typeof e.msg!=="undefined"&&e.msg){jAlert(e.msg)}else{jAlert("Something went wrong")}}},error:function(e,t,n){console.log(e.responseText)}})},setCash:function(e){jQuery("#player_cash").html('<a class="info">$'+formatNumReadable(e/100)+'<span style="width:240px !important;">Networth: $'+formatNum(e/100,2)+"</span></a>")},getCash:function(){var e={action:"get_cash"};this.executeAjax(e,function(e){playerController.setCash(e.cash)})}};var progressController={queue_prod_count:0,queue_prod_cd_on:[],queue_prod_cd_remaining:[],queue_res_count:0,queue_res_cd_on:[],queue_res_cd_remaining:[],executeAjax:function(e,t){jQuery.ajax({type:"POST",url:"progress_controller.php",data:e,dataType:"json",success:function(e){if(e.success){if(typeof e.update_queue_prod!=="undefined"&&e.update_queue_prod){var n=e.queue_prod.length;if(n){var r="";var i=0;var s=0;for(var o=0;o<n;o++){var u=e.queue_prod[o];if(i!=u.ffid){if(i!=0){if(s>2){if(s>3){if(s>4){r+='<span style="display:inline-block;width:20px;"></span><i>... '+(s-3)+" more items ...</i><br />"}else{r+='<span style="display:inline-block;width:20px;"></span><i>... '+(s-3)+" more item ...</i><br />"}}var a=e.queue_prod[o-1];if(a.has_icon!="0"){var f=a.name.toLowerCase().replace(/[\s\&\']/g,"_").replace(/_{2,}/g,"_")}else{var f="no-icon"}r+='<span id="queue_prod_cd_cancel_'+(o-1)+'"><img src="/eos/images/x.gif" style="cursor:pointer;" onclick="progressController.cancelQueue(\'fact\','+a.id+');" /></span> '+a.opid1n+' <img src="/eos/images/prod/'+f+'.gif" title="'+a.name+'" width="16" /> (Q'+formatNum(a.opid1q,0,1)+')<div id="queue_prod_cd_'+(o-1)+'" class="timer" ></div><br />';progressController.queue_prod_cd_remaining[o-1]=a.endtime-e.timenow;progressController.queue_prod_cd_on[o-1]=1}r+="</div>"}s=0;i=u.ffid;r+='<a class="jqDialog" href="factories-production.php?ffid='+u.ffid+'">'+u.fact_name+"</a> <a onclick=\"toggleDisplayNone('queue_prod_ffid_wrapper_"+o+'\');"><span id="queue_prod_ffid_wrapper_'+o+'_ctrl">(-)</span></a><br /><div id="queue_prod_ffid_wrapper_'+o+'">'}s++;if(s<=2){if(u.has_icon!="0"){var f=u.name.toLowerCase().replace(/[\s\&\']/g,"_").replace(/_{2,}/g,"_")}else{var f="no-icon"}r+='<span id="queue_prod_cd_cancel_'+o+'"><img src="/eos/images/x.gif" style="cursor:pointer;" onclick="progressController.cancelQueue(\'fact\','+u.id+');" /></span> '+u.opid1n+' <img src="/eos/images/prod/'+f+'.gif" title="'+u.name+'" width="16" /> (Q'+formatNum(u.opid1q,0,1)+')<div id="queue_prod_cd_'+o+'" class="timer" ></div><br />';progressController.queue_prod_cd_remaining[o]=u.endtime-e.timenow;progressController.queue_prod_cd_on[o]=1}else{progressController.queue_prod_cd_remaining[o]=3600;progressController.queue_prod_cd_on[o]=0}}if(s>2){if(s>3){if(s>4){r+='<span style="display:inline-block;width:20px;"></span><i>... '+(s-3)+" more items ...</i><br />"}else{r+='<span style="display:inline-block;width:20px;"></span><i>... '+(s-3)+" more item ...</i><br />"}}var a=u;if(a.has_icon!="0"){var f=a.name.toLowerCase().replace(/[\s\&\']/g,"_").replace(/_{2,}/g,"_")}else{var f="no-icon"}r+='<span id="queue_prod_cd_cancel_'+(o-1)+'"><img src="/eos/images/x.gif" style="cursor:pointer;" onclick="progressController.cancelQueue(\'fact\','+a.id+');" /></span> '+a.opid1n+' <img src="/eos/images/prod/'+f+'.gif" title="'+a.name+'" width="16" /> (Q'+formatNum(a.opid1q,0,1)+')<div id="queue_prod_cd_'+(o-1)+'" class="timer" ></div><br />';progressController.queue_prod_cd_remaining[o-1]=a.endtime-e.timenow;progressController.queue_prod_cd_on[o-1]=1}r+="</div>"}else{r="None"}jQuery("#progress_prod").html(r);progressController.queue_prod_count=n}if(typeof e.update_queue_res!=="undefined"&&e.update_queue_res){var l=e.queue_res.length;if(l){var c="";var h=0;var s=0;for(var o=0;o<l;o++){var p=e.queue_res[o];if(h!=p.frid){if(h!=0){if(s>2){if(s>3){if(s>4){c+='<span style="display:inline-block;width:20px;"></span><i>... '+(s-3)+" more items ...</i><br />"}else{c+='<span style="display:inline-block;width:20px;"></span><i>... '+(s-3)+" more item ...</i><br />"}}var d=e.queue_res[o-1];if(d.has_icon!="0"){var f=d.name.toLowerCase().replace(/[\s\&\']/g,"_").replace(/_{2,}/g,"_")}else{var f="no-icon"}c+='<span id="queue_res_cd_cancel_'+(o-1)+'"><img src="/eos/images/x.gif" style="cursor:pointer;" onclick="progressController.cancelQueue(\'rnd\','+d.id+');" /></span> <img src="/eos/images/prod/'+f+'.gif" title="'+d.name+'" width="16" /> (Q'+d.newlevel+')<div id="queue_res_cd_'+(o-1)+'" class="timer" ></div><br />';progressController.queue_res_cd_remaining[o-1]=d.endtime-e.timenow;progressController.queue_res_cd_on[o-1]=1}c+="</div>"}s=0;h=p.frid;c+='<a class="jqDialog" href="rnd-res.php?frid='+p.frid+'">'+p.rnd_name+"</a> <a onclick=\"toggleDisplayNone('queue_res_frid_wrapper_"+o+'\');"><span id="queue_res_frid_wrapper_'+o+'_ctrl">(-)</span></a><br /><div id="queue_res_frid_wrapper_'+o+'">'}s++;if(s<=2){if(p.has_icon!="0"){var f=p.name.toLowerCase().replace(/[\s\&\']/g,"_").replace(/_{2,}/g,"_")}else{var f="no-icon"}c+='<span id="queue_res_cd_cancel_'+o+'"><img src="/eos/images/x.gif" style="cursor:pointer;" onclick="progressController.cancelQueue(\'rnd\','+p.id+');" /></span> <img src="/eos/images/prod/'+f+'.gif" title="'+p.name+'" width="16" /> (Q'+p.newlevel+')<div id="queue_res_cd_'+o+'" class="timer" ></div><br />';progressController.queue_res_cd_remaining[o]=p.endtime-e.timenow;progressController.queue_res_cd_on[o]=1}else{progressController.queue_res_cd_remaining[o]=3600;progressController.queue_res_cd_on[o]=0}}if(s>2){if(s>3){if(s>4){c+='<span style="display:inline-block;width:20px;"></span><i>... '+(s-3)+" more items ...</i><br />"}else{c+='<span style="display:inline-block;width:20px;"></span><i>... '+(s-3)+" more item ...</i><br />"}}var d=p;if(d.has_icon!="0"){var f=d.name.toLowerCase().replace(/[\s\&\']/g,"_").replace(/_{2,}/g,"_")}else{var f="no-icon"}c+='<span id="queue_res_cd_cancel_'+(o-1)+'"><img src="/eos/images/x.gif" style="cursor:pointer;" onclick="progressController.cancelQueue(\'rnd\','+d.id+');" /></span> <img src="/eos/images/prod/'+f+'.gif" title="'+d.name+'" width="16" /> (Q'+d.newlevel+')<div id="queue_res_cd_'+(o-1)+'" class="timer" ></div><br />';progressController.queue_res_cd_remaining[o-1]=d.endtime-e.timenow;progressController.queue_res_cd_on[o-1]=1}c+="</div>"}else{c="None"}jQuery("#progress_res").html(c);progressController.queue_res_count=l}if(typeof t==="function"){t(e)}}else{if(typeof e.msg!=="undefined"&&e.msg){jAlert(e.msg)}else{jAlert("Something went wrong")}}},error:function(e,t,n){console.log(e.responseText)}})},countDown:function(){for(i=0;i<this.queue_prod_count;i++){if(this.queue_prod_cd_on[i]){this.queue_prod_cd_remaining[i]=Math.max(0,this.queue_prod_cd_remaining[i]-1);jQuery("#queue_prod_cd_"+i).html(sec2hms(this.queue_prod_cd_remaining[i]));if(this.queue_prod_cd_remaining[i]<=0){jQuery("#queue_prod_cd_"+i).html("Completed");jQuery("#queue_prod_cd_cancel_"+i).html("");this.queue_prod_cd_on[i]=0}}}for(i=0;i<this.queue_res_count;i++){if(this.queue_res_cd_on[i]){this.queue_res_cd_remaining[i]=Math.max(0,this.queue_res_cd_remaining[i]-1);jQuery("#queue_res_cd_"+i).html(sec2hms(this.queue_res_cd_remaining[i]));if(this.queue_res_cd_remaining[i]<=0){jQuery("#queue_res_cd_"+i).html("Completed");jQuery("#queue_res_cd_cancel_"+i).html("");this.queue_res_cd_on[i]=0}}}},refreshQueue:function(e,t){if(typeof (e==="undefined"))e="all";var n={action:"refresh_queue",type:e};if(typeof t==="function"){this.executeAjax(n,t)}else{this.executeAjax(n)}},cancelQueue:function(e,t,n){var r={action:"cancel_queue",type:e,queue_id:t};if(typeof n==="function"){this.executeAjax(r,n)}else{this.executeAjax(r,function(t){if(typeof t.slot_affected!=="undefined"&&t.slot_affected&&t.slot){bldgController.updateSlot(t.slot)}progressController.refreshQueue(e)})}},hurryQueue:function(e,t,n){var r={action:"hurry_queue",type:e,queue_id:t};if(typeof n==="function"){this.executeAjax(r,n)}else{this.executeAjax(r,function(t){if(typeof t.slot_affected!=="undefined"&&t.slot_affected&&t.slot){bldgController.updateSlot(t.slot)}progressController.refreshQueue(e)})}}};var questsController={executeAjax:function(e,t){jQuery.ajax({type:"POST",url:"quests_controller.php",data:e,dataType:"json",success:function(e){if(e.success){if(typeof t==="function"){t(e)}}else{if(typeof e.msg!=="undefined"&&e.msg){jAlert(e.msg)}else{jAlert("Something went wrong")}}},error:function(e,t,n){console.log(e.responseText)}})},validateQuest:function(e){var t={action:"validate_quest",fqid:e};this.executeAjax(t,function(t){jQuery("#ongoing_quest_"+e).html(t.msg);if(t.completed){firmController.getAll()}})},supplyProd:function(e,t){snum=document.getElementById("snum").value;var n={action:"supply_prod",fqid:e,snum:snum,wh_id:t};this.executeAjax(n,function(t){jQuery("#quest_supply_form").html(t.msg);if(parseInt(jQuery(".ui-dialog").css("top"))<jQuery(window).scrollTop()){jQuery(".ui-dialog").get(0).scrollIntoView()}questsController.validateQuest(e)})}};var rankingsController={executeAjax:function(e,t){jQuery.ajax({type:"POST",url:"rankings_controller.php",data:e,dataType:"json",success:function(e){if(e.success){if(typeof t==="function"){t(e)}}else{if(typeof e.msg!=="undefined"&&e.msg){jAlert(e.msg)}else{jAlert("Something went wrong")}}},error:function(e,t,n){console.log(e.responseText)}})},showTable:function(e,t,n){if(typeof n==="undefined")n=0;var r={action:"show_table",page_num:e,view_type:t};this.executeAjax(r,function(r){var i=Math.ceil(r.totalItems/r.perPage);rankingsController.showMenu(r.pageNum,i,"'"+t+"'");var s='			<thead> 				<tr> 					<td colspan="3">'+r.title+"</td> 				</tr> 			</thead> 			<tbody>";var o=s;if(r.results.length){var u=r.perPage*(e-1),a;var f=Math.min(Math.ceil(r.perPage/2),r.results.length);for(var l=0;l<f;l++){u++;var c=r.results[l];s+="<tr><td>"+u+"</td>";s+='<td><div class="ranking_item"><a href="'+r.type+"/"+c.id+'">'+c.name+"</a></div></td>";if(r.value_type=="money"){a="$"+formatNumReadable(c.value/100)}else if(r.value_type=="large_integer"){a=formatNumReadable(c.value)}else if(r.value_type=="integer"){a=c.value}else{a=c.value}s+="<td>"+a+"</td></tr>"}for(var l=Math.ceil(r.perPage/2);l<r.results.length;l++){u++;var c=r.results[l];o+="<tr><td>"+u+"</td>";o+='<td><div class="ranking_item"><a href="'+r.type+"/"+c.id+'">'+c.name+"</a></div></td>";if(r.value_type=="money"){a="$"+formatNumReadable(c.value/100)}else if(r.value_type=="large_integer"){a=formatNumReadable(c.value)}else if(r.value_type=="integer"){a=c.value}else{a=c.value}o+="<td>"+a+"</td></tr>"}}else{s+='				<tr><td colspan="3">No result</td></tr>';o+='				<tr><td colspan="3">No result</td></tr>'}s+="			</tbody>";o+="			</tbody>";jQuery("#ranking_table_1").html(s);jQuery("#ranking_table_2").html(o);if(!n){document.getElementById("ranking_top_nav").scrollIntoView()}})},showMenu:function(e,t,n,r){var i="";var s;if(typeof r==="undefined")r="showTable";if(t>1){if(e>1){s=e-1;i+='<div class="table_nav"> <a onclick="rankingsController.'+r+"("+s+", "+n+')">Prev</a> '}else{i+='<div class="table_nav"> <a class="disabled">Prev</a> '}for(var o=1;o<=t;o++){if(o!=e){i+=' <a onclick="rankingsController.'+r+"("+o+", "+n+')">'+o+"</a> "}else{i+=' <a class="selected" onclick="rankingsController.'+r+"("+o+", "+n+')">'+o+"</a> "}}if(e<t){s=e+1;i+=' <a onclick="rankingsController.'+r+"("+s+", "+n+')">Next</a> </div>'}else{i+=' <a class="disabled">Next</a> </div>'}}jQuery(".ranking_nav_container").html(i)}};var settingsController={executeAjax:function(e,t){jQuery.ajax({type:"POST",url:"settings_controller.php",data:e,dataType:"json",success:function(e){if(e.success){if(typeof t==="function"){t(e)}}else{if(typeof e.msg!=="undefined"&&e.msg){jAlert(e.msg)}else{jAlert("Something went wrong")}}},error:function(e,t,n){console.log(e.responseText)}})},toggleOnOff:function(e,t){var n={action:"toggle_on_off",setting:e};this.executeAjax(n,function(e){if(typeof e.title!=="undefined"){jQuery("#"+t).children("td").eq(0).children("input").eq(0).val(e.title)}})},updateB2BRowsPerPage:function(e,t){var n={action:"update_b2b_rows_per_page",rows:e};this.executeAjax(n,function(e){jQuery("#"+t).children("td").eq(0).append('<br /><span id="temp_div_'+t+'"><img src="/eos/images/check.gif" /> Updated</span>');setTimeout(function(){$("#temp_div_"+t).remove()},3e3)})},checkPlayerName:function(){var e=document.getElementById("new_player_name").value;var t={action:"check_player_name",name:e};jQuery.ajax({type:"POST",url:"settings_controller.php",data:t,dataType:"json",success:function(e){if(e.success){jQuery("#name_check_response").css({color:"#338033"});jQuery("#name_check_response").html(e.msg);jQuery("#p_name_submit").prop("disabled",false)}else{jQuery("#name_check_response").css({color:"#ff0000"});jQuery("#name_check_response").html(e.msg);jQuery("#p_name_submit").prop("disabled",true)}},error:function(e,t,n){console.log(e.responseText)}})},updatePlayerName:function(){clearTimeout(searchTimeout);var e=document.getElementById("new_player_name").value;var t={action:"update_player_name",name:e};this.executeAjax(t,function(t){var n="<h3>Name Changed</h3> 			Your player name has been changed to the following:<br /><br />";n+=e;n+='<br /><br /> 			<input type="button" class="bigger_input" value="Click here to continue" onclick="document.location.reload(true);" />';jQuery("#p_name_form").html(n);if(parseInt(jQuery(".ui-dialog").css("top"))<jQuery(window).scrollTop()){jQuery(".ui-dialog").get(0).scrollIntoView()}})},checkPlayerAlias:function(){var e=document.getElementById("new_player_alias").value;var t={action:"check_player_alias",alias:e};jQuery.ajax({type:"POST",url:"settings_controller.php",data:t,dataType:"json",success:function(e){if(e.success){jQuery("#alias_check_response").css({color:"#338033"});jQuery("#alias_check_response").html(e.msg);jQuery("#p_alias_submit").prop("disabled",false)}else{jQuery("#alias_check_response").css({color:"#ff0000"});jQuery("#alias_check_response").html(e.msg);jQuery("#p_alias_submit").prop("disabled",true)}},error:function(e,t,n){console.log(e.responseText)}})},updatePlayerAlias:function(){var e=document.getElementById("new_player_alias").value;var t={action:"update_player_alias",alias:e};this.executeAjax(t,function(t){var n="<h3>Alias Updated</h3> 			Your player alias has been updated to the following:<br /><br />";n+=e;jQuery("#p_alias_form").html(n);if(parseInt(jQuery(".ui-dialog").css("top"))<jQuery(window).scrollTop()){jQuery(".ui-dialog").get(0).scrollIntoView()}})},updatePlayerDesc:function(){var e=document.getElementById("player_desc").value;var t={action:"update_player_desc",desc:e};this.executeAjax(t,function(e){var t="<h3>Description Updated</h3> 			Your player description has been updated to the following:<br /><br />";t+=e.desc;jQuery("#p_desc_form").html(t);if(parseInt(jQuery(".ui-dialog").css("top"))<jQuery(window).scrollTop()){jQuery(".ui-dialog").get(0).scrollIntoView()}})},updatePlayerAvatar:function(e){jQuery("#avatar_preview").html('<img class="img_b3px" src="images/players/'+e.filename+"?"+moment().unix()+'" />')},setVacationMode:function(){var e=jQuery("input:checkbox:checked.vacation_cb").map(function(){return this.value}).get();var t=document.getElementById("vacation_duration").value;var n={action:"vacation_mode",firm_ids:e,vacation_duration:t};this.executeAjax(n,function(e){var t="<h3>Lock Down Successful</h3> 			Your lock down order was issued and acknowledged.";t+='<br /><br /> 			<input type="button" class="bigger_input" value="Click here to continue" onclick="document.location.reload(true);" />';jQuery("#vacation_form").html(t);if(parseInt(jQuery(".ui-dialog").css("top"))<jQuery(window).scrollTop()){jQuery(".ui-dialog").get(0).scrollIntoView()}})},restartPlayer:function(){var e=document.getElementById("restart_confirmation").value;var t={action:"restart_player",restart_confirmation:e};this.executeAjax(t,function(e){if(typeof e.bonus_techs!=="undefined"){var t="<h3>Restart Successful</h3> 				You have been awarded the following researches:<br /><br />";for(i in e.bonus_techs){var n=e.bonus_techs[i];t+="Quality "+n[2]+" "+n[1]+"<br />"}t+='<br /><br /> 				<input type="button" class="bigger_input" value="Click here to continue" onclick="document.location.reload(true);" />';jQuery("#restart_form").html(t);if(parseInt(jQuery(".ui-dialog").css("top"))<jQuery(window).scrollTop()){jQuery(".ui-dialog").get(0).scrollIntoView()}}})}};var stockController={lastDivId:0,lastRan:0,activeSDTab:"fundamentals",addOrderPOPrice:0,addOrderPOShares:0,addOrderBuybackPrice:0,addOrderBuybackShares:0,SDRunning:0,stockData:null,stockPlot:null,stockControllerPlot:null,executeAjax:function(e,t){jQuery.ajax({type:"POST",url:"stock_controller.php",data:e,dataType:"json",success:function(e){if(e.success){if(typeof t==="function"){t(e)}}else{if(typeof e.msg!=="undefined"&&e.msg){jAlert(e.msg)}else{jAlert("Something went wrong")}}},error:function(e,t,n){console.log(e.responseText)}})},showTable:function(e,t,n,r){if(typeof n==="undefined")n=0;if(typeof r==="undefined")r=0;var i={action:"show_table",page_num:e,view_type:t,view_type_id:n};this.executeAjax(i,function(e){var i=Math.ceil(e.totalItems/e.perPage);stockController.showMenu(e.pageNum,i,"'"+t+"', '"+n+"'");var s='			<thead> 				<tr> 					<td>Symbol</td><td>Price</td><td>Gain</td><td style="width:60px;text-align:center;">Actions</td> 				</tr> 			</thead> 			<tbody>';if(e.results.length){for(var o in e.results){var u=e.results[o];s+='<tr id="stock_display_'+u.fid+'" class="stock_tr" stock_fid="'+u.fid+'">';s+='<td><a href="stock-details.php?ss='+u.symbol+'">'+u.symbol+"</a></td><td>$"+formatNum(u.share_price/100,2,0)+"</td><td>"+formatNum(u.gain,0,1)+"%</td>";s+='<td style="text-align:center;white-space:nowrap;"><a class="jqDialog" href="stock-add-order.php?ss='+u.symbol+'"><img src="/eos/images/button-trade-small.gif" title="Add Order" /></a> ';if(t=="watchlist"){s+='<a onclick="stockController.removeFromWatchlist('+u.fid+')"><img src="/eos/images/button-trash-small.gif" title="Remove from Watchlist" /></a> '}s+="</td></tr>"}}else{s+='				<tr><td colspan="4">No stocks found.</td></tr>'}s+="			</tbody>";document.getElementById("stock_table").style.display="";jQuery("#stock_table").html(s);if(!r){document.getElementById("stock_submenu").scrollIntoView()}})},refreshRow:function(e){var t={action:"refresh_row",stock_fid:e};stockController.executeAjax(t,function(t){if(t.notFound==1){jQuery("#stock_display_"+e).fadeOut(500,function(){jQuery("#stock_display_"+e).html('<td colspan="4"><b><i>NOT FOUND</i></b></td>').fadeIn(500)})}else{var n="";var r=t.resultRow;n+='<td><a href="stock-details.php?ss='+r.symbol+'">'+r.symbol+"</a></td><td>$"+formatNum(r.share_price/100,2,0)+"</td><td>"+formatNum(r.gain,0,1)+"%</td>";n+='<td style="text-align:center;white-space:nowrap;"><a class="jqDialog" href="stock-add-order.php?ss='+r.symbol+'"><img src="/eos/images/button-trade-small.gif" title="Add Order" /></a> ';if(viewType=="watchlist"){n+='<a onclick="stockController.removeFromWatchlist('+r.fid+')"><img src="/eos/images/button-trash-small.gif" title="Remove from Watchlist" /></a> '}n+="</td>";jQuery("#stock_display_"+e).fadeOut(500,function(){jQuery("#stock_display_"+e).html(n).fadeIn(500)})}})},showTablePO:function(e,t,n,r){if(typeof n==="undefined")n=0;if(typeof r==="undefined")r=0;var i={action:"show_table",page_num:e,view_type:t,view_type_id:n};this.executeAjax(i,function(e){var i=Math.ceil(e.totalItems/e.perPage);stockController.showMenu(e.pageNum,i,"'"+t+"', '"+n+"'","showTablePO");var s='			<thead> 				<tr> 					<td>Symbol</td><td>Type</td><td>Shares Available</td><td>Share Price</td><td>Ends</td><td style="width:60px;text-align:center;">Actions</td> 				</tr> 			</thead> 			<tbody>';if(e.results.length){for(var o in e.results){var u=e.results[o];s+='<tr id="stock_po_display_'+u.id+'" class="stock_tr">';s+='<td><a href="stock-details.php?ss='+u.symbol+'">'+u.symbol+"</a></td>";s+="<td>"+u.type+"</td>";s+="<td>"+formatNum(u.shares,0,0)+"</td><td>$"+formatNum(u.price/100,2,0)+"</td>";s+="<td>"+moment(u.expiration).format("MMM D")+"</td>";if(u.started==1){s+='<td style="text-align:center;white-space:nowrap;"><a class="jqDialog" href="stock-add-order.php?ss='+u.symbol+'"><img src="/eos/images/button-trade-small.gif" title="Add Order" /></a> '}else{s+='<td style="text-align:center;white-space:nowrap;"><a class="info"><img src="/eos/images/button-trade-small-inactive.gif" title="Starts on '+u.starts+'" /></a> '}s+="</td></tr>"}}else{s+='				<tr><td colspan="6">No public offering found.</td></tr>'}s+="			</tbody>";jQuery("#stock_table").html(s);if(!r){document.getElementById("stock_submenu").scrollIntoView()}})},refreshRowPO:function(e){var t={action:"refresh_row",po_id:e};stockController.executeAjax(t,function(t){if(t.notFound==1){jQuery("#stock_po_display_"+e).fadeOut(500,function(){jQuery("#stock_po_display_"+e).html('<td colspan="6"><b><i>NOT FOUND</i></b></td>').fadeIn(500)})}else{var n="";var r=t.resultRow;n+='<td><a href="stock-details.php?ss='+r.symbol+'">'+r.symbol+"</a></td>";n+="<td>"+r.type+"</td>";n+="<td>"+formatNum(r.shares,0,0)+"</td><td>$"+formatNum(r.price/100,2,0)+"</td>";n+="<td>"+moment(r.expiration).format("MMM D")+"</td>";if(r.started==1){n+='<td style="text-align:center;white-space:nowrap;"><a class="jqDialog" href="stock-add-order.php?ss='+r.symbol+'"><img src="/eos/images/button-trade-small.gif" title="Add Order" /></a> '}else{n+='<td style="text-align:center;white-space:nowrap;"><a class="info"><img src="/eos/images/button-trade-small-inactive.gif" title="Starts on '+r.starts+'" /></a> '}n+="</td>";jQuery("#stock_po_display_"+e).fadeOut(500,function(){jQuery("#stock_po_display_"+e).html(n).fadeIn(500)})}})},showTableBid:function(e,t,n,r){if(typeof n==="undefined")n=0;if(typeof r==="undefined")r=0;var i={action:"show_table",page_num:e,view_type:t,view_type_id:n};this.executeAjax(i,function(e){var i=Math.ceil(e.totalItems/e.perPage);stockController.showMenu(e.pageNum,i,"'"+t+"', '"+n+"'","showTableBid",".stock_bid_nav_container");var s='			<thead> 				<tr> 					<td>Symbol</td><td>Shares</td><td>Price</td><td>Expiration</td><td style="width:60px;text-align:center;">Actions</td> 				</tr> 			</thead> 			<tbody>';if(e.results.length){for(var o in e.results){var u=e.results[o];s+='<tr id="stock_bid_display_'+u.id+'" class="stock_tr">';s+='<td><a href="stock-details.php?ss='+u.symbol+'">'+u.symbol+"</a></td>";if(u.aon=="0"){s+="<td>"+formatNum(u.shares,0,0)+"</td>"}else{s+="<td>"+formatNum(u.shares,0,0)+" AON</td>"}if(u.price==999999999){s+="<td>MP</td>"}else{s+="<td>$"+formatNum(u.price/100,2,0)+"</td>"}s+="<td>"+moment(u.expiration).format("MMM D")+"</td>";s+='<td style="text-align:center;white-space:nowrap;"><a class="jqDialog" href="stock-add-order.php?type=edit&order_type=bid&order_id='+u.id+'"><img src="/eos/images/button-edit-small.gif" title="Cancel Order" /></a> <a onclick="stockController.cancelOrder('+u.id+', \'bid\');"><img src="/eos/images/button-trash-small.gif" title="Cancel Order" /></a> ';s+="</td></tr>"}}else{s+='				<tr><td colspan="5">No orders found.</td></tr>'}s+="			</tbody>";jQuery("#stock_bid_table").html(s);if(!r){document.getElementById("stock_submenu").scrollIntoView()}})},showTableAsk:function(e,t,n,r){if(typeof n==="undefined")n=0;if(typeof r==="undefined")r=0;var i={action:"show_table",page_num:e,view_type:t,view_type_id:n};this.executeAjax(i,function(e){var i=Math.ceil(e.totalItems/e.perPage);stockController.showMenu(e.pageNum,i,"'"+t+"', '"+n+"'","showTableAsk",".stock_ask_nav_container");var s='			<thead> 				<tr> 					<td>Symbol</td><td>Shares</td><td>Price</td><td>Expiration</td><td style="width:60px;text-align:center;">Actions</td> 				</tr> 			</thead> 			<tbody>';if(e.results.length){for(var o in e.results){var u=e.results[o];s+='<tr id="stock_ask_display_'+u.id+'" class="stock_tr">';s+='<td><a href="stock-details.php?ss='+u.symbol+'">'+u.symbol+"</a></td>";s+="<td>"+formatNum(u.shares,0,0)+"</td>";if(u.price==1){s+="<td>MP</td>"}else{s+="<td>$"+formatNum(u.price/100,2,0)+"</td>"}s+="<td>"+moment(u.expiration).format("MMM D")+"</td>";s+='<td style="text-align:center;white-space:nowrap;"><a class="jqDialog" href="stock-add-order.php?type=edit&order_type=ask&order_id='+u.id+'"><img src="/eos/images/button-edit-small.gif" title="Cancel Order" /></a> <a onclick="stockController.cancelOrder('+u.id+', \'ask\');"><img src="/eos/images/button-trash-small.gif" title="Cancel Order" /></a> ';s+="</td></tr>"}}else{s+='				<tr><td colspan="5">No orders found.</td></tr>'}s+="			</tbody>";jQuery("#stock_ask_table").html(s);if(!r){document.getElementById("stock_submenu").scrollIntoView()}})},showTableHistory:function(e,t,n,r){if(typeof n==="undefined")n=0;if(typeof r==="undefined")r=0;var i={action:"show_table",page_num:e,view_type:t,view_type_id:n};this.executeAjax(i,function(e){var i=Math.ceil(e.totalItems/e.perPage);stockController.showMenu(e.pageNum,i,"'"+t+"', '"+n+"'","showTableHistory");var s='			<thead> 				<tr> 					<td>Symbol</td><td>Shares</td><td>Share Price</td><td>Amount</td><td>Date</td><td style="width:60px;text-align:center;">Actions</td> 				</tr> 			</thead> 			<tbody>';if(e.results.length){for(var o in e.results){var u=e.results[o];s+='<tr id="stock_display_'+u.fid+'" class="stock_tr" stock_fid="'+u.fid+'">';s+='<td><a href="stock-details.php?ss='+u.symbol+'">'+u.symbol+"</a></td>";if(u.bpid==playerController.playerId){s+="<td>"+formatNum(u.shares,0,0)+"</td><td>$"+formatNum(1.01/100*u.share_price,2,0)+"</td>";s+='<td><span style="color:#ff0000;">($'+formatNum(1.01/100*u.total_price,0,2)+")</span></td>"}else{s+="<td>-"+formatNum(u.shares,0,0)+"</td><td>$"+formatNum(.99/100*u.share_price,2,0)+"</td>";s+="<td>$"+formatNum(.99/100*u.total_price,0,2)+"</td>"}s+="<td>"+moment(u.transaction_time).format("MMM D")+"</td>";s+='<td style="text-align:center;white-space:nowrap;"><a class="jqDialog" href="stock-add-order.php?ss='+u.symbol+'"><img src="/eos/images/button-trade-small.gif" title="Add Order" /></a> ';s+="</td></tr>"}}else{s+='				<tr><td colspan="6">No history found.</td></tr>'}s+="			</tbody>";jQuery("#stock_table").html(s);if(!r){document.getElementById("stock_submenu").scrollIntoView()}})},showTablePortfolio:function(e,t,n,r){if(typeof n==="undefined")n=0;if(typeof r==="undefined")r=0;var i={action:"show_table",page_num:e,view_type:t,view_type_id:n};this.executeAjax(i,function(e){var i=Math.ceil(e.totalItems/e.perPage);stockController.showMenu(e.pageNum,i,"'"+t+"', '"+n+"'","showTablePortfolio");var s='			<thead> 				<tr> 					<td>Symbol</td><td>Shares</td><td>Share Price</td><td>Value</td><td style="width:60px;text-align:center;">Actions</td> 				</tr> 			</thead> 			<tbody>';if(e.results.length){for(var o in e.results){var u=e.results[o];s+='<tr id="stock_display_'+u.fid+'" class="stock_tr" stock_fid="'+u.fid+'">';s+='<td><a href="stock-details.php?ss='+u.symbol+'">'+u.symbol+"</a></td>";s+="<td>"+formatNum(u.shares,0,0)+"</td><td>$"+formatNum(u.share_price/100,2,0)+"</td>";s+="<td>$"+formatNumReadable(u.shares*u.share_price/100)+"</td>";s+='<td style="text-align:center;white-space:nowrap;"><a class="jqDialog" href="stock-add-order.php?ss='+u.symbol+'"><img src="/eos/images/button-trade-small.gif" title="Add Order" /></a> ';s+="</td></tr>"}}else{s+='				<tr><td colspan="5">None found.</td></tr>'}s+="			</tbody>";jQuery("#stock_table").html(s);if(!r){document.getElementById("stock_submenu").scrollIntoView()}})},showMenu:function(e,t,n,r,i){var s="";var o;if(typeof r==="undefined")r="showTable";if(typeof i==="undefined")i=".stock_nav_container";if(t>1){if(e>1){o=e-1;s+='<div class="table_nav"> <a onclick="stockController.'+r+"("+o+", "+n+')">Prev</a> '}else{s+='<div class="table_nav"> <a class="disabled">Prev</a> '}for(var u=1;u<=t;u++){if(u-e>=10||e-u>=5){if(u-e==10||e-u==5){s+=' <a onclick="stockController.'+r+"("+u+", "+n+')">...</a> '}}else{if(u!=e){s+=' <a onclick="stockController.'+r+"("+u+", "+n+')">'+u+"</a> "}else{s+=' <a class="selected" onclick="stockController.'+r+"("+u+", "+n+')">'+u+"</a> "}}}if(e<t){o=e+1;s+=' <a onclick="stockController.'+r+"("+o+", "+n+')">Next</a> </div>'}else{s+=' <a class="disabled">Next</a> </div>'}}jQuery(i).html(s)},showStockDetails:function(e,t){if(stockController.SDRunning){return false}stockController.SDRunning=1;if(t!="fundamentals"&&t!="revenue"&&t!="recent_b2b"&&t!="buildings"&&t!="researches"&&t!="shareholders"){stockController.SDRunning=0;return false}jQuery.ajax({type:"POST",url:"stock_controller.php",data:{action:"show_sd_"+t,stock_fid:e}}).done(function(e){jQuery("#sd_btn_"+stockController.activeSDTab).removeClass("active");jQuery("#stock_details_content").fadeOut(300,function(){jQuery("#stock_details_content").html(e).fadeIn(300,function(){document.getElementById("sd_btn_fundamentals").scrollIntoView()});jQuery("#sd_btn_"+t).addClass("active");stockController.activeSDTab=t;stockController.SDRunning=0})})},addOrder:function(e,t){if(typeof e==="undefined")e=0;if(typeof t==="undefined")t=0;oldOrderId=0;oldOrderType="";if(e){oldOrderId=document.getElementById("old_order_id").value;oldOrderType=document.getElementById("old_order_type").value}var n=document.getElementById("order_type").value;if(!n){jAlert("Please select an order type!");return false}var r=document.getElementById("order_symbol").value;if(!r){jAlert("Please enter a stock symbol!");return false}var i=Math.round(stripCommas(document.getElementById("order_shares").value));var s=0;if(jQuery("#order_shares_aon").prop("checked")){s=1}var o=Math.round(stripCommas(document.getElementById("order_price").value)*100);var u=0;if(jQuery("#order_price_mp").prop("checked")){u=1}var a=document.getElementById("order_expiration").value;var f={action:"add_order",is_edit:e,old_order_id:oldOrderId,old_order_type:oldOrderType,order_type:n,ss:r,shares:i,aon:s,price:o,mp:u,expiration:a};stockController.executeAjax(f,function(e){if(e.completed){playerController.getCash();$("#add_order_form").html(e.summary)}else{var r=new RegExp("^.*/([^/]*)");var i=window.location.pathname.replace(r,"$1");if(i=="stock-orders.php"){jQuery("#jq-dialog-modal").dialog("close");if(n=="bid"){stockController.showTableBid(1,"bid",0)}if(n=="ask"){stockController.showTableAsk(1,"ask",0)}}else{if(t){$("#add_order_form").html("Order successfully added.")}else{window.location.href="/eos/stock-orders.php"}}}})},addOrderValidateSymbol:function(e,t){if(typeof e==="undefined"||e==""){jQuery("#order_type").html("").prop("disabled",true)}if(typeof t==="undefined")t="";var n={action:"validate_symbol",symbol:e};stockController.executeAjax(n,function(e){if(e.found){jQuery("#validate_symbol_result").html('<img src="/eos/images/check.gif" />');var n=new Array;if(!e.po){n["bid"]="Buy";n["ask"]="Sell"}else{if(e.podata.type=="IPO"){if(e.podata.started==1){n["ipo"]="Buy from IPO";stockController.addOrderPOPrice=e.podata.price;stockController.addOrderPOShares=e.podata.shares}}else{n["bid"]="Buy";n["ask"]="Sell";if(e.podata.started==1){if(e.podata.type=="SEO"){n["seo"]="Buy from SEO";stockController.addOrderPOPrice=e.podata.price;stockController.addOrderPOShares=e.podata.shares}if(e.podata.type=="Buyback"){n["obb"]="Sell to Buyback";stockController.addOrderOBBPrice=e.podata.price;stockController.addOrderBuybackShares=e.podata.shares}}}}var r="";for(var i in n){if(i==t){r+='<option value="'+i+'" selected="selected">'+n[i]+"</option>"}else{r+='<option value="'+i+'">'+n[i]+"</option>"}}jQuery("#order_type").html(r).prop("disabled",false)}else{jQuery("#validate_symbol_result").html('<img src="/eos/images/x.gif" />');jQuery("#order_type").html("").prop("disabled",true)}})},cancelOrder:function(e,t){var n=(new Date).valueOf()*.01|0;var r=n-stockController.lastRan;if(stockController.lastDivId==e&&r<15){return false}stockController.lastDivId=e;stockController.lastRan=n;var i={action:"cancel_order",order_id:e,order_type:t};stockController.executeAjax(i,function(n){if(t=="bid"){jQuery("#stock_bid_display_"+e).fadeOut(500,function(){jQuery("#stock_bid_display_"+e).html('<td colspan="5"><i>'+n.msg+"</i></td>").fadeIn(500)})}else if(t=="ask"){jQuery("#stock_ask_display_"+e).fadeOut(500,function(){jQuery("#stock_ask_display_"+e).html('<td colspan="5"><i>'+n.msg+"</i></td>").fadeIn(500)})}})},findSymbol:function(){var e=jQuery("#new_find_symbol").val();var t={action:"show_table",page_num:0,view_type:"find_symbol",view_type_id:e};this.executeAjax(t,function(e){var t=Math.ceil(e.totalItems/e.perPage);var n='			<thead> 				<tr> 					<td>Symbol</td><td>Company</td><td style="width:60px;text-align:center;">Actions</td> 				</tr> 			</thead> 			<tbody>';if(e.results.length){for(var r in e.results){var i=e.results[r];n+='<tr id="stock_display_'+i.fid+'" class="stock_tr" stock_fid="'+i.fid+'">';n+='<td><a href="stock-details.php?ss='+i.symbol+'">'+i.symbol+"</a></td>";n+='<td><a href="/eos/firm/'+i.fid+'">'+i.firm_name+"</a></td>";n+='<td style="text-align:center;white-space:nowrap;"><a class="jqDialog" href="stock-add-order.php?ss='+i.symbol+'"><img src="/eos/images/button-trade-small.gif" title="Add Order" /></a> <a onclick="stockController.addToWatchlist(\''+i.symbol+'\');"><img src="/eos/images/star.gif" title="Add to Watchlist" /></a> ';n+="</td></tr>"}}else{n+='				<tr><td colspan="3">None found.</td></tr>'}n+="			</tbody>";jQuery("#find_symbols_table").html(n)})},addToWatchlist:function(e){if(typeof e==="undefined")e=jQuery("#new_watchlist_symbol").val();var t={action:"add_to_watchlist",symbol:e};stockController.executeAjax(t,function(e){jQuery("#new_watchlist_symbol").val("");stockController.showTable(1,"watchlist",0,1)})},removeFromWatchlist:function(e){var t={action:"remove_from_watchlist",stock_fid:e};stockController.executeAjax(t,function(t){jQuery("#stock_display_"+e).fadeOut(500)})},checkSymbolName:function(){var e=document.getElementById("new_symbol_name").value;var t={action:"check_symbol_name",symbol:e};jQuery.ajax({type:"POST",url:"stock_controller.php",data:t,dataType:"json",success:function(e){if(e.success){jQuery("#name_check_response").css({color:"#338033"});jQuery("#name_check_response").html(e.msg);jQuery("#symbol_name_submit").prop("disabled",false)}else{jQuery("#name_check_response").css({color:"#ff0000"});jQuery("#name_check_response").html(e.msg);jQuery("#symbol_name_submit").prop("disabled",true)}},error:function(e,t,n){console.log(e.responseText)}})},startIPO:function(){clearTimeout(searchTimeout);var e=document.getElementById("new_symbol_name").value;var t=document.getElementById("capital_to_raise").value;var n=document.getElementById("share_price").value;var r={action:"start_ipo",symbol:e,capital_to_raise:t,share_price:n};this.executeAjax(r,function(t){var n='<h3>IPO Initiated</h3> 			You can find your IPO under <a href="/eos/stock-po.php">Public Offerings</a> with the symbol '+e;jQuery("#ipo_form").html(n);firmController.getCash()})},startSEO:function(){var e=document.getElementById("capital_to_raise").value;var t=document.getElementById("share_price").value;var n={action:"start_seo",capital_to_raise:e,share_price:t};this.executeAjax(n,function(e){var t='<h3>SEO Initiated</h3> 			You can find your SEO under <a href="/eos/stock-po.php">Public Offerings</a>.';jQuery("#seo_form").html(t);firmController.getCash()})},startBuyback:function(){var e=document.getElementById("shares_to_repurc").value;var t=document.getElementById("share_price").value;var n={action:"start_buyback",shares_to_repurc:e,share_price:t};this.executeAjax(n,function(e){var t='<h3>Buyback Initiated</h3> 			You can find your Buyback under <a href="/eos/stock-po.php">Public Offerings</a>.';jQuery("#buyback_form").html(t);firmController.getCash()})},startSplit:function(){var e=document.getElementById("split_choice").value;if(e==""){return false}var t=e.split("_");var n=t[0];var r=t[1];var i={action:"start_split",split_from:n,split_to:r};this.executeAjax(i,function(e){var t="<h3>Split Successful</h3> 			New total shares: "+formatNumReadable(e.total_shares)+"<br /> 			New share price: $"+formatNumReadable(e.share_price/100);if(e.total_repurc_value!="0"){t+="<br />Cash paid for fraction shares: $"+formatNumReadable(e.total_repurc_value/100)}jQuery("#split_form").html(t);firmController.getCash()})},goPrivate:function(){var e=document.getElementById("go_private_conf").value;var t={action:"go_private",go_private_conf:e};this.executeAjax(t,function(e){var t="<h3>Go Private Results</h3> 			Your company repurchased "+formatNumReadable(e.shares_to_repurc)+" shares for a total of $"+formatNumReadable(e.total_cost/100)+".<br /> 			Congratulations! Your company is once again a private company.";jQuery("#go_private_form").html(t);firmController.getCash()})},setDividend:function(){clearTimeout(checkDividendTimeout);var e=document.getElementById("dividend").value;var t={action:"set_dividend",dividend:e};this.executeAjax(t,function(e){jQuery("#dividend_form").html("You have successfully changed the company's dividend to $"+formatNum(e.dividend,2)+".")})}};var storeController={executeAjax:function(e,t){jQuery.ajax({type:"POST",url:"stores_controller.php",data:e,dataType:"json",success:function(e){if(e.success){if(typeof t==="function"){t(e)}}else{if(typeof e.msg!=="undefined"&&e.msg){jAlert(e.msg)}else{jAlert("Something went wrong")}}},error:function(e,t,n){console.log(e.responseText)}})},pasteToAll:function(e){var t={action:"paste_to_all",fsid:e};this.executeAjax(t,function(t){jAlert("Success!");jqDialogInit("stores-sell.php?fsid="+e)})},lazyPricing:function(e){var t={action:"lazy_pricing",fsid:e};this.executeAjax(t,function(t){jAlert("Success!");jqDialogInit("stores-sell.php?fsid="+e)})},toggleSellable:function(e,t){if(typeof t==="undefined")t=1;var n={action:"toggle_sellable",wh_id:e};this.executeAjax(n,function(n){if(n.selling){if(typeof sales_price!=="undefined"){sales_price[e]=n.price;document.getElementById("sales_price_visible_"+e).value=sales_price[e]/100;document.getElementById("sales_price_visible_"+e).style.color="#00AA00"}if(typeof document.getElementById("store_sns_div_"+e)!=="undefined"&&document.getElementById("store_sns_div_"+e)!==null){if(t){document.getElementById("store_sns_div_"+e).style.display="none"}else{document.getElementById("store_sns_div_"+e).style.backgroundImage='url("images/anim_gear_2.gif")';jQuery("#store_sns_div_"+e).html('<img src="images/translucent.png" alt="Pause Sales" title="Click to Pause Sales" width="40" height="40" onclick="toggleSellable('+e+","+t+');" />')}}}else{if(typeof document.getElementById("store_sns_div_"+e)!=="undefined"&&document.getElementById("store_sns_div_"+e)!==null){if(t){document.getElementById("store_sns_div_"+e).style.display=""}else{document.getElementById("store_sns_div_"+e).style.backgroundImage='url("images/gear_inactive.png")';jQuery("#store_sns_div_"+e).html('<img src="images/translucent.png" alt="Start Selling" title="Click to Start Selling" width="40" height="40" onclick="toggleSellable('+e+","+t+');" />')}}}})}};var tutorialController={executeAjax:function(e,t){jQuery.ajax({type:"POST",url:"tutorial_controller.php",data:e,dataType:"json",success:function(e){if(e.success){if(typeof t==="function"){t(e)}}else{if(typeof e.msg!=="undefined"&&e.msg){jAlert(e.msg)}else{jAlert("Something went wrong")}}},error:function(e,t,n){console.log(e.responseText)}})},showContent:function(){var e={action:"show_content"};jQuery.ajax({type:"POST",url:"tutorial_controller.php",data:e,dataType:"html",success:function(e){jQuery("#tutorial_div").html(e);tutorialController.setAppleseed()},error:function(e,t,n){console.log(e.responseText)}})},showFboxContent:function(e){var t={action:"show_fbox_content",content_name:e};jQuery.ajax({type:"POST",url:"tutorial_controller.php",data:t,dataType:"html",success:function(e){jQuery("#jq-dialog-modal").html(e).dialog({modal:true,width:rjJQModalWidth,zIndex:9900,resizable:false,open:function(){jQuery("#jq-dialog-modal a").blur();jQuery("#jq-dialog-modal .bigger_input").blur();jQuery(".ui-dialog").get(0).scrollIntoView()},beforeClose:function(){modalController.backLink="";modalController.backLinkTitle="";if(typeof modalController.modalCdt!=="undefined"&&modalController.modalCdt)clearInterval(modalController.modalCdt)}})},error:function(e,t,n){console.log(e.responseText)}})},updateProgress:function(e){var t={action:"update_progress",progress:e};this.executeAjax(t,function(e){if(typeof e.end_tutorial!=="undefined"&&e.end_tutorial){window.location.href="/eos/index.php"}else{tutorialController.showContent()}})},checkPlayerName:function(){var e=document.getElementById("new_player_name").value;var t={action:"check_player_name",name:e};jQuery.ajax({type:"POST",url:"tutorial_controller.php",data:t,dataType:"json",success:function(e){if(e.success){jQuery("#name_check_response").css({color:"#338033"});jQuery("#name_check_response").html(e.msg);jQuery("#p_name_submit").prop("disabled",false)}else{jQuery("#name_check_response").css({color:"#ff0000"});jQuery("#name_check_response").html(e.msg);jQuery("#p_name_submit").prop("disabled",true)}},error:function(e,t,n){console.log(e.responseText)}})},submitPlayerName:function(){clearTimeout(searchTimeout);var e=document.getElementById("new_player_name").value;var t={action:"update_player_name",name:e};this.executeAjax(t,function(t){jQuery("#eos_stats_panel_player").children("div").eq(0).children("a").eq(0).text(e);tutorialController.showContent()})},setAppleseed:function(){if(!document.getElementById("eos_stats_panel_firm")){jQuery("#spd_control_content").removeClass("displayed");jQuery("#eos_stats_panel").append('<div id="eos_stats_panel_firm"><div style="margin-bottom:4px;"><a title="Uncle Johnny\'s company">Appleseed Co.</a></div><div class="spd_item"><img title="Cash" src="/eos/images/money.gif"> <span id="firm_cash"><a class="info">$32.4 B<span style="width:240px !important;">Cash: $32,428,372,456.53</span></a></span></div><div class="spd_item"><img title="Loan" src="/eos/images/loan.png"> <span id="firm_loan"><a class="info">$0.00<span style="width:240px !important;">Loan: $0.00</span></a></span></div><div class="spd_item"><img title="Networth" src="/eos/images/networth.gif"> <span id="firm_networth"><a class="info">$32.4 B<span style="width:240px !important;">Networth: $32,431,172,456.53<br>Networth is updated daily around midnight server time.</span></a></span></div><div class="spd_item"><img title="Level" src="/eos/images/star.gif"> <span id="firm_level"><a class="info">Large Cap<span style="width:240px !important;">Company Level: 10 (Large Cap)<br>Next Level: 11 (Conglomerate)<br>At $100,000,000,000 NW ($100 B)</span></a></span></div><div class="spd_item"><img title="Fame" src="/eos/images/fame.gif"> <span id="firm_fame_level"><a class="info">Unknown<span style="width:240px !important;">Company Fame Level: 0 (Unknown)<br>Next Level: 1 (Unknown)<br>Current EXP: 0/100</span></a></span></div></div>')}},sellToMarket:function(){var e=Math.floor(stripCommas(document.getElementById("sell_quantity_123456").value));var t=Math.round(stripCommas(document.getElementById("sell_price_123456").value)*100);if(e!=5e4){jAlert("Please enter 50000 as the Sale Quantity.");return false}if(t!=200){jAlert("Please enter 2 as the Unit Price.");return false}jQuery("#wh_display_123456").fadeOut(500,function(){jQuery("#wh_display_123456").html('<td colspan="8">50,000 unit(s) of apple(s) listed the on market for $2.00 ea.</td>').fadeIn(500,function(){setTimeout(function(){jQuery("#wh_display_123456").fadeOut(500,function(){jQuery("#wh_display_123456").html('<td style="border-right: none;"><a onclick="jAlert(\'Disabled in tutorial.\');"><img src="/eos/images/prod/apple.gif"></a></td><td class="warehouse_prod_name">Apple</td><td>0.00</td><td>4,999,950,000</td><td>$0.20</td><td><input type="text" maxlength="15" size="8" id="sell_quantity_123456"></td><td><input type="text" maxlength="9" size="8" id="sell_price_123456"></td><td><a onclick="tutorialController.sellToMarket();"><img title="Sell on Market" src="/eos/images/button-sell-small.gif"></a> <a onclick="jAlert(\'Disabled in tutorial.\');"><img title="View on Market" src="/eos/images/button-magnifier-small.gif"></a> <a onclick="jAlert(\'Disabled in tutorial.\');"><img title="Discard" src="/eos/images/button-trash-small.gif"></a></td>').fadeIn(500);tutorialController.showFboxContent("warehouse_1")})},3e3)})})},createPlayer:function(){var e=document.getElementById("restart_confirmation").value;var t={action:"restart_player",restart_confirmation:e};this.executeAjax(t,function(e){if(typeof e.bonus_techs!=="undefined"){var t="<h3>Restart Successful</h3> 				You have been awarded the following researches:<br /><br />";for(i in e.bonus_techs){var n=e.bonus_techs[i];t+="Quality "+n[2]+" "+n[1]+"<br />"}t+='<br /><br /> 				<input type="button" class="bigger_input" value="Click here to continue" onclick="document.location.reload(true);" />';jQuery("#restart_form").html(t);if(parseInt(jQuery(".ui-dialog").css("top"))<jQuery(window).scrollTop()){jQuery(".ui-dialog").get(0).scrollIntoView()}}})}};var warehouseController={lastDivId:0,lastRan:0,executeAjax:function(e,t){jQuery.ajax({type:"POST",url:"warehouse_controller.php",data:e,dataType:"json",success:function(e){if(e.success){if(typeof t==="function"){t(e)}}else{if(typeof e.msg!=="undefined"&&e.msg){jAlert(e.msg)}else{jAlert("Something went wrong")}}},error:function(e,t,n){console.log(e.responseText)}})},showTable:function(e,t,n,r){if(typeof n==="undefined")n=0;if(typeof r==="undefined")r=0;var i={action:"show_table",page_num:e,view_type:t,view_type_id:n};this.executeAjax(i,function(e){if(typeof e.needTypeId!=="undefined"&&e.needTypeId){var i="";if(e.typeResults.length){var s=t;var o="type_id_item";if(t=="cat"){s=t+"/large";o="type_id_item cat"}for(var u in e.typeResults){var a=e.typeResults[u];i+='<div class="'+o+'"><a href="warehouse.php?view_type='+t+"&view_type_id="+a.id+'" title="'+a.name+'"><img src="/eos/images/'+s+"/"+a.name.toLowerCase().replace(/[\s\&\']/g,"_").replace(/_{2,}/g,"_")+'.gif" /><br />'+a.name+"</a></div>"}}else{i="Warehouse is empty."}document.getElementById("wh_table").style.display="none";jQuery(".wh_nav_container").html("");document.getElementById("type_id_choices").style.display="";jQuery("#type_id_choices").html(i)}else{var f=Math.ceil(e.totalItems/e.perPage);warehouseController.showMenu(e.pageNum,f,t,n);var l='				<thead> 					<tr> 						<td colspan="2">Product</td><td>Quality</td><td>Quantity</td><td>Cost</td><td>Sale Quantity</td><td>Unit Price</td><td style="width:113px;">Actions</td> 					</tr> 				</thead> 				<tbody>';if(e.results.length){for(var u in e.results){var c=e.results[u];l+='<tr id="wh_display_'+c.id+'" class="wh_tr" wh_id="'+c.id+'">';if(c.has_icon!="0"){var h=c.name.toLowerCase().replace(/[\s\&\']/g,"_").replace(/_{2,}/g,"_")}else{var h="no-icon"}l+='<td style="border-right: none;"><a class="jqDialog" href="/eos/pedia-product-view.php?pid='+c.pid+'" title="View '+c.name+' on EOS-Pedia"><img src="/eos/images/prod/'+h+'.gif" /></a></td><td class="warehouse_prod_name">'+c.name+"</td><td>"+formatNum(c.pidq,2,0)+"</td><td>"+formatNum(c.pidn,0,1)+"</td><td>$"+formatNumReadable(c.pidcost/100)+'</td><td><input id="sell_quantity_'+c.id+'" type="text" size="8" maxlength="15" /></td><td><input id="sell_price_'+c.id+'" type="text" size="8" maxlength="9" /></td><td><a onclick="warehouseController.sellToMarket('+c.id+');"><img src="/eos/images/button-sell-small.gif" title="Sell on Market" /></a> <a href="/eos/market.php?view_type=prod&view_type_id='+c.pid+'"><img src="/eos/images/button-magnifier-small.gif" title="View on Market" /></a> <a onclick="warehouseController.warehouseDiscard('+c.id+');"><img src="/eos/images/button-trash-small.gif" title="Discard" /></a></td></tr>'}}else{l+='					<tr><td colspan="8">Warehouse is empty.</td></tr>'}l+="				</tbody>";document.getElementById("type_id_choices").style.display="none";document.getElementById("wh_table").style.display="";jQuery("#wh_table").html(l);if(!r){document.getElementById("wh_submenu").scrollIntoView()}}})},refreshRow:function(e){var t={action:"refresh_row",wh_id:e};warehouseController.executeAjax(t,function(t){if(t.notFound==1){jQuery("#wh_display_"+e).fadeOut(500)}else{var n=t.resultRow;if(n.has_icon!="0"){var r=n.name.toLowerCase().replace(/[\s\&\']/g,"_").replace(/_{2,}/g,"_")}else{var r="no-icon"}var i='<td style="border-right: none;"><a class="jqDialog" href="/eos/pedia-product-view.php?pid='+n.pid+'" title="View '+n.name+' on EOS-Pedia"><img src="/eos/images/prod/'+r+'.gif" /></a></td><td class="warehouse_prod_name">'+n.name+"</td><td>"+formatNum(n.pidq,2,0)+"</td><td>"+formatNum(n.pidn,0,1)+"</td><td>$"+formatNumReadable(n.pidcost/100)+'</td><td><input id="sell_quantity_'+n.id+'" type="text" size="8" maxlength="15" /></td><td><input id="sell_price_'+n.id+'" type="text" size="8" maxlength="9" /></td><td><a onclick="warehouseController.sellToMarket('+n.id+');"><img src="/eos/images/button-sell-small.gif" title="Sell on Market" /></a> <a href="/eos/market.php?view_type=prod&view_type_id='+n.pid+'"><img src="/eos/images/button-magnifier-small.gif" title="View on Market" /></a> <a onclick="warehouseController.warehouseDiscard('+n.id+');"><img src="/eos/images/button-trash-small.gif" title="Discard" /></a></td>';jQuery("#wh_display_"+e).fadeOut(500,function(){jQuery("#wh_display_"+e).html(i).fadeIn(500)})}})},showMenu:function(e,t,n,r){var i="";var s;if(t>1){if(e>1){s=e-1;i+='<div class="table_nav"> <a onclick="warehouseController.showTable('+s+", '"+n+"', "+r+')">Prev</a> '}else{i+='<div class="table_nav"> <a class="disabled">Prev</a> '}for(var o=1;o<=t;o++){if(o-e>=10||e-o>=5){if(o-e==10||e-o==5){i+=' <a onclick="warehouseController.showTable('+o+", '"+n+"', "+r+')">...</a> '}}else{if(o!=e){i+=' <a onclick="warehouseController.showTable('+o+", '"+n+"', "+r+')">'+o+"</a> "}else{i+=' <a class="selected" onclick="warehouseController.showTable('+o+", '"+n+"', "+r+')">'+o+"</a> "}}}if(e<t){s=e+1;i+=' <a onclick="warehouseController.showTable('+s+", '"+n+"', "+r+')">Next</a> </div>'}else{i+=' <a class="disabled">Next</a> </div>'}}jQuery(".wh_nav_container").html(i)},warehouseDiscard:function(e){jConfirm("Are you sure you want to DISCARD ALL of this product? You will NOT be able to undo this action.","Discard Products",function(t){if(t){var n={action:"discard",wh_id:e};warehouseController.executeAjax(n,function(t){jQuery("#wh_display_"+e).fadeOut(500)})}})},sellToMarket:function(e,t){if(typeof t==="undefined")t=0;var n=Math.floor(stripCommas(document.getElementById("sell_quantity_"+e).value));var r=Math.round(stripCommas(document.getElementById("sell_price_"+e).value)*100);var i=(new Date).valueOf()*.01|0;var s=i-warehouseController.lastRan;if(warehouseController.lastDivId==e&&s<15){return false}warehouseController.lastDivId=e;warehouseController.lastRan=i;var o={action:"sell_to_market",wh_id:e,sell_num:n,sell_price:r,force_listing:t};warehouseController.executeAjax(o,function(t){if(typeof t.confNeeded!=="undefined"&&t.confNeeded){jConfirm(t.confMsg,"Confirmation Needed",function(t){if(t){warehouseController.sellToMarket(e,1)}})}else{jQuery("#wh_display_"+e).fadeOut(500,function(){jQuery("#wh_display_"+e).html('<td colspan="8">'+t.msg+"</td>").fadeIn(500,function(){setTimeout("warehouseController.refreshRow("+e+");",3e3)})})}})}}